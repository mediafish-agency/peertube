import{a as mn,c as pn}from"./chunk-XGXRY5NY.js";import{b as cn,c as bt}from"./chunk-IA75VPMY.js";import{a as un}from"./chunk-OOKZXLTV.js";import{a as We,b as an,c as Be,h as Ve,i as Ue,j as ke,k as sn,l as ze,m as ln,n as _n,o as dn,p as Ge}from"./chunk-VPUMNBNK.js";import{a as we,c as en,d as tn,e as He,f as on,g as Fe}from"./chunk-FDM4WNGU.js";import{a as nn}from"./chunk-FCT3LKDI.js";import{a as ht}from"./chunk-LQ3CTFST.js";import{a as Nt}from"./chunk-JPIRBOZL.js";import{c as rn}from"./chunk-GP5LX4CA.js";import{a as xt}from"./chunk-4XL6BJ7M.js";import{a as $e}from"./chunk-GOWSOB6U.js";import{B as De,r as Se}from"./chunk-XEFO2OX5.js";import{a as U}from"./chunk-WRZZAQTV.js";import{b as ue,c as Ae}from"./chunk-RZGVOE4L.js";import{A as pe,c as se,d as ct,f as le,g as _e,l as he,o as de,r as ce,z as me}from"./chunk-AHXSH3AS.js";import{$ as Ee,$a as At,Ab as O,Af as Yt,B as Z,Bb as b,Bf as ft,Ca as i,Cb as kt,Da as u,Eb as zt,Fb as Gt,Gb as Xt,Gc as Qt,Gf as yn,Ib as $,Jb as ee,Jf as Le,K as Bt,Kb as h,Kc as gt,La as L,Lb as jt,Ne as ve,Oa as E,Oe as Ie,Of as ye,Sa as l,Sb as K,Tb as qt,Te as Tt,Ub as re,Ue as Kt,Wb as ae,Y as mt,Ye as Pe,Za as ut,Zc as Oe,_a as St,ab as r,ad as Ne,ba as x,bb as a,bd as Ct,cb as S,da as pt,db as v,eb as I,fg as H,gb as y,gg as Mt,hg as xe,ib as q,jb as Q,jf as yt,jg as J,kb as p,kg as Jt,la as T,lb as Ce,ma as f,mb as Te,nb as Lt,ob as M,od as te,pb as c,pc as V,pg as Zt,qb as Vt,qc as Et,qg as Rt,rb as Ut,rc as w,sa as ie,ug as Ot,vb as F,wb as W,xb as B,xd as be,ya as G,yc as Y,za as ge,zb as g}from"./chunk-4A7FW7VV.js";import{a as Ft,b as Wt,g as Ln,j as _,k as j}from"./chunk-K6ICEIKK.js";var ne=class ne{constructor(s,e,t){this.authHttp=s;this.restExtractor=e;this.restService=t;}list(s){let{pagination:e,sort:t}=s,o=this.buildServerOrAccountListPath(s),d=new Qt();return d=this.restService.addRestGetParams(d,e,t),this.authHttp.get(o,{params:d}).pipe(Z(A=>this.restExtractor.handleError(A)));}addList(s){let{listName:e,words:t}=s,o=this.buildServerOrAccountListPath(s),d={listName:e,words:t};return this.authHttp.post(o,d).pipe(Z(A=>this.restExtractor.handleError(A)));}updateList(s){let{listName:e,words:t}=s,o=this.buildServerOrAccountListPath(s),d={listName:e,words:t};return this.authHttp.put(o,d).pipe(Z(A=>this.restExtractor.handleError(A)));}deleteList(s){let e=this.buildServerOrAccountListPath(s);return this.authHttp.delete(e).pipe(Z(t=>this.restExtractor.handleError(t)));}buildServerOrAccountListPath(s){let e=s.accountName?"/accounts/"+s.accountName+"/lists":"/server/lists";return s.listId&&(e+="/"+s.listId),ne.BASE_WATCHED_WORDS_URL+e;}};_(ne,"BASE_WATCHED_WORDS_URL",Kt.apiUrl+"/api/v1/watched-words/"),_(ne,"\u0275fac",function(e){return new(e||ne)(Ee(gt),Ee(Mt),Ee(Jt));}),_(ne,"\u0275prov",mt({token:ne,factory:ne.ɵfac}));var Xe=ne;var fe=class fe{constructor(s,e){this.authHttp=s;this.restExtractor=e;}requestTwoFactor(s){let{userId:e,currentPassword:t}=s,o=Ot.BASE_USERS_URL+e+"/two-factor/request";return this.authHttp.post(o,{currentPassword:t}).pipe(Z(d=>this.restExtractor.handleError(d)));}confirmTwoFactorRequest(s){let{userId:e,requestToken:t,otpToken:o}=s,d=Ot.BASE_USERS_URL+e+"/two-factor/confirm-request";return this.authHttp.post(d,{requestToken:t,otpToken:o}).pipe(Z(A=>this.restExtractor.handleError(A)));}disableTwoFactor(s){let{userId:e,currentPassword:t}=s,o=Ot.BASE_USERS_URL+e+"/two-factor/disable";return this.authHttp.post(o,{currentPassword:t}).pipe(Z(d=>this.restExtractor.handleError(d)));}};_(fe,"\u0275fac",function(e){return new(e||fe)(Ee(gt),Ee(Mt));}),_(fe,"\u0275prov",mt({token:fe,factory:fe.ɵfac}));var An=fe;var Rn=Ln(yn());var $n=["modal"],wn=n=>({"input-error":n}),Hn=(n,s)=>({"by-moderator":n,"by-me":s});function Fn(n,s){n&1&&(v(0),p(1,1),I());}function Wn(n,s){n&1&&(v(0),p(1,2),I());}function Bn(n,s){if(n&1&&(r(0,"div",19)(1,"div",20),g(2),a(),r(3,"div",21),S(4,"div",22),r(5,"div",23),g(6),K(7,"date"),a()()()),n&2){let e=s.$implicit,t=c(2);l("ngClass",jt(6,Hn,e.byModerator,t.isMessageByMe(e))),i(2),O(e.account.name),i(2),l("innerHTML",e.messageHtml,G),i(2),O(qt(7,4,e.createdAt));}}function Vn(n,s){n&1&&(r(0,"div",24),p(1,3),a());}function Un(n,s){if(n&1&&(r(0,"div",25),g(1),a()),n&2){let e=c(2);i(),b(" ",e.formErrors.message," ");}}function kn(n,s){if(n&1){let e=y();r(0,"div",4)(1,"h4",5),E(2,Fn,2,0,"ng-container",6)(3,Wn,2,0,"ng-container",6),a(),r(4,"button",7),M("click",function(){T(e);let o=c();return f(o.hide());}),S(5,"my-global-icon",8),a()(),r(6,"div",9)(7,"div",10),E(8,Bn,8,9,"div",11),a(),E(9,Vn,2,0,"div",12),r(10,"form",13),M("ngSubmit",function(){T(e);let o=c();return f(o.addMessage());}),r(11,"div",14),S(12,"textarea",15),E(13,Un,2,1,"div",16),a(),r(14,"div",17),S(15,"input",18),a()()();}if(n&2){let e=c();i(2),l("ngIf",e.isAdminView),i(),l("ngIf",!e.isAdminView),i(5),l("ngForOf",e.abuseMessages),i(),l("ngIf",e.noResults),i(),l("formGroup",e.form),i(2),l("placeholder",e.getPlaceholderMessage())("ngClass",h(9,wn,e.formErrors.message)),i(),l("ngIf",e.formErrors.message),i(2),l("disabled",!e.form.valid||e.sendingMessage);}}var je=class je extends Ae{constructor(e,t,o,d,A,m){super();this.formReactiveService=e;this.modalService=t;this.htmlRenderer=o;this.auth=d;this.notifier=A;this.abuseService=m;_(this,"modal");_(this,"isAdminView");_(this,"countMessagesUpdated",new ie());_(this,"abuseMessages",[]);_(this,"textareaMessage");_(this,"sendingMessage",!1);_(this,"noResults",!1);_(this,"openedModal");_(this,"abuse");}ngOnInit(){this.buildForm({message:tn});}openModal(e){this.abuse=e,this.openedModal=this.modalService.open(this.modal,{centered:!0}),this.loadMessages();}hide(){this.abuseMessages=[],this.openedModal.close();}addMessage(){this.sendingMessage=!0,this.abuseService.addAbuseMessage(this.abuse,this.form.value.message).subscribe({next:()=>{this.form.reset(),this.sendingMessage=!1,this.countMessagesUpdated.emit({abuseId:this.abuse.id,countMessages:this.abuseMessages.length+1}),this.loadMessages();},error:e=>{this.sendingMessage=!1,Tt.error(e),this.notifier.error("Sorry but you cannot send this message. Please retry later");}});}deleteMessage(e){this.abuseService.deleteAbuseMessage(this.abuse,e).subscribe({next:()=>{this.countMessagesUpdated.emit({abuseId:this.abuse.id,countMessages:this.abuseMessages.length-1}),this.abuseMessages=this.abuseMessages.filter(t=>t.id!==e.id);},error:t=>this.notifier.error(t.message)});}isMessageByMe(e){return this.auth.getUser().account.id===e.account.id;}getPlaceholderMessage(){return this.isAdminView?"\u6DFB\u52A0\u6D88\u606F\u4E0E\u4E3E\u62A5\u8005\u8FDB\u884C\u4EA4\u6D41":"\u6DFB\u52A0\u6D88\u606F\u4E0E\u5BA1\u6838\u56E2\u961F\u8FDB\u884C\u4EA4\u6D41";}loadMessages(){this.abuseService.listAbuseMessages(this.abuse).subscribe({next:e=>{this.abuseMessages=[];for(let t of e.data)this.abuseMessages.push(Object.assign(t,{messageHtml:this.htmlRenderer.convertToBr(t.message)}));this.noResults=this.abuseMessages.length===0,setTimeout(()=>{let t=document.querySelector(".messages");t.scroll(0,t.scrollHeight);});},error:e=>this.notifier.error(e.message)});}};_(je,"\u0275fac",function(t){return new(t||je)(u(ue),u(Se),u(Zt),u(xe),u(H),u(He));}),_(je,"\u0275cmp",x({type:je,selectors:[["my-abuse-message-modal"]],viewQuery:function(t,o){if(t&1&&F($n,7),t&2){let d;W(d=B())&&(o.modal=d.first);}},inputs:{isAdminView:"isAdminView"},outputs:{countMessagesUpdated:"countMessagesUpdated"},standalone:!0,features:[L,$],decls:2,vars:0,consts:()=>{let e;e="Close this modal";let t;t="\u6DFB\u52A0\u6D88\u606F";let o;o="\u4E0E\u4E3E\u62A5\u8005\u95F4\u7684\u6D88\u606F";let d;d="\u4E0E\u5BA1\u6838\u56E2\u961F\u95F4\u7684\u6D88\u606F";let A;return A="\u6682\u65F6\u6CA1\u6709\u6D88\u606F\u3002",[["modal",""],o,d,A,[1,"modal-header"],[1,"modal-title"],[4,"ngIf"],["title",e,1,"border-0","p-0",3,"click"],["iconName","cross"],[1,"modal-body"],[1,"messages"],["class","message-block",3,"ngClass",4,"ngFor","ngForOf"],["class","no-messages",4,"ngIf"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-group"],["formControlName","message","ngbAutofocus","",1,"form-control",3,"placeholder","ngClass"],["class","form-error","role","alert",4,"ngIf"],[1,"form-group","inputs"],["type","submit","value",t,1,"peertube-button","orange-button",3,"disabled"],[1,"message-block",3,"ngClass"],[1,"author"],[1,"bubble"],[1,"content",3,"innerHTML"],[1,"date"],[1,"no-messages"],["role","alert",1,"form-error"]];},template:function(t,o){t&1&&E(0,kn,16,11,"ng-template",null,0,ae);},dependencies:[w,U,Et,V,me,he,se,le,_e,pe,de,ce,Y],styles:["form[_ngcontent-%COMP%]{margin:20px 20px 0 0}form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]:first-child{min-height:125px}textarea[_ngcontent-%COMP%]{margin-top:20px;color:var(--textareaForegroundColor)!important;background-color:var(--textareaBackgroundColor)!important;height:70px;font-size:15px;padding:3px 15px;width:100%;max-width:100%;color:var(--inputForegroundColor);background-color:var(--inputBackgroundColor);border:1px solid var(--inputBorderColor);border-radius:3px;line-height:23px}textarea[_ngcontent-%COMP%]::placeholder{color:var(--inputPlaceholderColor)}textarea[readonly][_ngcontent-%COMP%]{opacity:.7}@media screen and (max-width: calc(100% + 40px)){textarea[_ngcontent-%COMP%]{width:100%}}.messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow-y:scroll;max-height:50vh}.no-messages[_ngcontent-%COMP%]{display:flex;justify-content:center}.message-block[_ngcontent-%COMP%]{margin:0 5px 10px 0;max-width:60%}.message-block[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]{color:var(--greyForegroundColor);font-size:14px;padding:0 0 3px 10px}.message-block[_ngcontent-%COMP%]   .bubble[_ngcontent-%COMP%]{border-radius:10px;padding:5px 10px;color:var(--mainForegroundColor);background-color:var(--greyBackgroundColor)}.message-block[_ngcontent-%COMP%]   .bubble[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:13px;color:var(--greyForegroundColor)}.message-block.by-me[_ngcontent-%COMP%]   .bubble[_ngcontent-%COMP%]{color:var(--mainBackgroundColor);background-color:var(--mainColorLighter)}.message-block.by-me[_ngcontent-%COMP%]   .bubble[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:var(--mainBackgroundColor)}.message-block.by-moderator[_ngcontent-%COMP%]{align-self:flex-end}"]}));var Dt=je;var zn=["modal"],Gn=n=>({"input-error":n});function Xn(n,s){if(n&1&&(r(0,"div",15),g(1),a()),n&2){let e=c(2);i(),b(" ",e.formErrors.moderationComment," ");}}function jn(n,s){if(n&1){let e=y();r(0,"div",3)(1,"h4",4),p(2,1),a(),r(3,"button",5),M("click",function(){T(e);let o=c();return f(o.hide());}),S(4,"my-global-icon",6),a()(),r(5,"div",7)(6,"form",8),M("ngSubmit",function(){T(e);let o=c();return f(o.banUser());}),r(7,"div",9)(8,"textarea",10),g(9,"        "),a(),E(10,Xn,2,1,"div",11),a(),r(11,"div",9),p(12,2),a(),r(13,"div",12)(14,"input",13),M("click",function(){T(e);let o=c();return f(o.hide());})("key.enter",function(){T(e);let o=c();return f(o.hide());}),a(),S(15,"input",14),a()()();}if(n&2){let e=c();i(6),l("formGroup",e.form),i(2),l("ngClass",h(4,Gn,e.formErrors.moderationComment)),i(2),l("ngIf",e.formErrors.moderationComment),i(5),l("disabled",!e.form.valid);}}var qe=class qe extends Ae{constructor(e,t,o,d){super();this.formReactiveService=e;this.modalService=t;this.notifier=o;this.abuseService=d;_(this,"modal");_(this,"commentUpdated",new ie());_(this,"abuseToComment");_(this,"openedModal");}ngOnInit(){this.buildForm({moderationComment:en});}openModal(e){this.abuseToComment=e,this.openedModal=this.modalService.open(this.modal,{centered:!0}),this.form.patchValue({moderationComment:this.abuseToComment.moderationComment});}hide(){this.abuseToComment=void 0,this.openedModal.close(),this.form.reset();}banUser(){let e=this.form.value.moderationComment;this.abuseService.updateAbuse(this.abuseToComment,{moderationComment:e}).subscribe({next:()=>{this.notifier.success("\u8BC4\u8BBA\u5DF2\u66F4\u65B0\u3002"),this.commentUpdated.emit(e),this.hide();},error:t=>this.notifier.error(t.message)});}};_(qe,"\u0275fac",function(t){return new(t||qe)(u(ue),u(Se),u(H),u(He));}),_(qe,"\u0275cmp",x({type:qe,selectors:[["my-moderation-comment-modal"]],viewQuery:function(t,o){if(t&1&&F(zn,7),t&2){let d;W(d=B())&&(o.modal=d.first);}},outputs:{commentUpdated:"commentUpdated"},standalone:!0,features:[L,$],decls:2,vars:0,consts:()=>{let e;e="Close this modal";let t;t="\u53D6\u6D88";let o;o="\u66F4\u65B0\u8BC4\u8BBA";let d;d="\u5BA1\u6838\u8BC4\u8BBA";let A;return A="\u6B64\u8BC4\u8BBA\u53EA\u5BF9\u4F60\u548C\u5176\u4ED6\u7248\u4E3B\u53EF\u89C1\u3002",[["modal",""],d,A,[1,"modal-header"],[1,"modal-title"],["title",e,1,"border-0","p-0",3,"click"],["iconName","cross"],[1,"modal-body"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-group"],["formControlName","moderationComment","ngbAutofocus","","i18-placeholder","","placeholder","Comment this report\u2026",1,"form-control",3,"ngClass"],["class","form-error","role","alert",4,"ngIf"],[1,"form-group","inputs"],["type","button","role","button","value",t,1,"peertube-button","grey-button",3,"click","key.enter"],["type","submit","value",o,1,"peertube-button","orange-button",3,"disabled"],["role","alert",1,"form-error"]];},template:function(t,o){t&1&&E(0,jn,16,6,"ng-template",null,0,ae);},dependencies:[U,me,he,se,le,_e,pe,de,ce,V,w],styles:["textarea[_ngcontent-%COMP%]{color:var(--textareaForegroundColor)!important;background-color:var(--textareaBackgroundColor)!important;height:100px;font-size:15px;padding:3px 15px;width:100%;max-width:100%;color:var(--inputForegroundColor);background-color:var(--inputBackgroundColor);border:1px solid var(--inputBorderColor);border-radius:3px;line-height:23px}textarea[_ngcontent-%COMP%]::placeholder{color:var(--inputPlaceholderColor)}textarea[readonly][_ngcontent-%COMP%]{opacity:.7}@media screen and (max-width: calc(100% + 40px)){textarea[_ngcontent-%COMP%]{width:100%}}"]}));var vt=qe;var Ke=()=>["."],Ye=n=>({search:n});function qn(n,s){if(n&1&&(r(0,"div",22)(1,"span",14),p(2,1),a(),r(3,"span",23)(4,"a",24),S(5,"my-actor-avatar",25),r(6,"div")(7,"span",26),g(8),a()()(),r(9,"a",27),q(10,2),S(11,"my-global-icon",28),Q(),a()()()),n&2){let e=c();i(4),l("routerLink",ee(8,Ke))("queryParams",h(9,Ye,'reporter:"'+e.abuse.reporterAccount.displayName+'"')),i(),l("actor",e.abuse.reporterAccount),i(3),O(e.abuse.reporterAccount.nameWithHost),i(),l("routerLink",ee(11,Ke))("queryParams",h(12,Ye,'reporter:"'+e.abuse.reporterAccount.displayName+'"')),i(2),Ce(e.abuse.countReportsForReporter)(e.abuse.countReportsForReporter),Te(10);}}function Qn(n,s){if(n&1&&(r(0,"a",27),q(1,4),S(2,"my-global-icon",28),Q(),a()),n&2){let e=c(2);l("routerLink",ee(4,Ke))("queryParams",h(5,Ye,'reportee:"'+e.abuse.flaggedAccount.displayName+'"')),i(2),Ce(e.abuse.countReportsForReportee)(e.abuse.countReportsForReportee),Te(1);}}function Kn(n,s){if(n&1&&(r(0,"div",22)(1,"span",14),p(2,3),a(),r(3,"span",23)(4,"a",24),S(5,"my-actor-avatar",25),r(6,"div")(7,"span",26),g(8),a()()(),E(9,Qn,3,7,"a",29),a()()),n&2){let e=c();i(4),l("routerLink",ee(5,Ke))("queryParams",h(6,Ye,'reportee:"'+e.abuse.flaggedAccount.displayName+'"')),i(),l("actor",e.abuse.flaggedAccount),i(3),O(e.abuse.flaggedAccount?e.abuse.flaggedAccount.nameWithHost:""),i(),l("ngIf",e.isAdminView);}}function Yn(n,s){if(n&1&&(r(0,"div",22)(1,"span",14),p(2,5),a(),r(3,"time",30),g(4),K(5,"date"),a()()),n&2){let e=c();i(4),O(re(5,1,e.abuse.updatedAt,"medium"));}}function Jn(n,s){if(n&1&&(r(0,"a",33)(1,"div"),g(2),a()()),n&2){let e=s.$implicit;l("routerLink",ee(3,Ke))("queryParams",h(4,Ye,"tag:"+e.id)),i(2),O(e.label);}}function Zn(n,s){if(n&1&&(r(0,"div",31)(1,"span"),E(2,Jn,3,6,"a",32),a()()),n&2){let e=c();i(2),l("ngForOf",e.predefinedReasons);}}function eo(n,s){if(n&1&&(v(0),g(1),I()),n&2){let e=c(2);i(),b(" - ",e.endAt,"");}}function to(n,s){if(n&1&&(r(0,"div",31)(1,"span",14),p(2,6),a(),r(3,"span"),g(4),E(5,eo,2,1,"ng-container",20),a()()),n&2){let e=c();i(4),b(" ",e.startAt,""),i(),l("ngIf",e.abuse.video.endAt);}}function no(n,s){if(n&1&&(r(0,"div",13)(1,"span",14),p(2,7),a(),S(3,"span",34),a()),n&2){let e=c();i(3),l("innerHTML",e.abuse.moderationCommentHtml,G);}}function oo(n,s){n&1&&(r(0,"div"),p(1,8),a());}function io(n,s){if(n&1&&S(0,"my-embed",36),n&2){let e=c(2);l("video",e.abuse.video);}}function ro(n,s){if(n&1&&(r(0,"div"),E(1,oo,2,0,"div",20)(2,io,1,1,"my-embed",35),a()),n&2){let e=c();i(),l("ngIf",e.abuse.video.deleted),i(),l("ngIf",!e.abuse.video.deleted);}}function ao(n,s){if(n&1&&(r(0,"div",37)(1,"div")(2,"strong"),p(3,9),a()(),S(4,"div",38),a()),n&2){let e=c();i(4),l("innerHTML",e.abuse.commentHTML,G);}}var Qe=class Qe{constructor(){_(this,"abuse");_(this,"isAdminView");_(this,"predefinedReasons");_(this,"predefinedReasonsTranslations");this.predefinedReasonsTranslations={violentOrRepulsive:"\u66B4\u529B\u6216\u4EE4\u4EBA\u53CD\u611F",hatefulOrAbusive:"\u4EC7\u6068\u6216\u8FB1\u9A82",spamOrMisleading:"\u5783\u573E\u6216\u8BEF\u5BFC",privacy:"\u9690\u79C1",rights:"\u7248\u6743",serverRules:"\u670D\u52A1\u5668\u89C4\u5219",thumbnails:"\u7F29\u7565\u56FE",captions:"\u5B57\u5E55"};}ngOnInit(){this.abuse.predefinedReasons&&(this.predefinedReasons=this.abuse.predefinedReasons.map(s=>({id:s,label:this.predefinedReasonsTranslations[s]})));}get startAt(){return yt(this.abuse.video.startAt);}get endAt(){return yt(this.abuse.video.endAt);}};_(Qe,"\u0275fac",function(e){return new(e||Qe)();}),_(Qe,"\u0275cmp",x({type:Qe,selectors:[["my-abuse-details"]],inputs:{abuse:"abuse",isAdminView:"isAdminView"},standalone:!0,features:[$],decls:18,vars:15,consts:()=>{let s;s="\u4E3E\u62A5";let e;e="\u4E3E\u62A5\u8005";let t;t="{VAR_PLURAL, plural, =1 {1 \u4E2A\u4E3E\u62A5} other {{INTERPOLATION} \u4E2A\u4E3E\u62A5}}",t=Lt(t,{INTERPOLATION:"\uFFFD1\uFFFD",VAR_PLURAL:"\uFFFD0\uFFFD"});let o;o=""+t+" "+"\uFFFD#11\uFFFD"+""+"\uFFFD/#11\uFFFD"+"";let d;d="\u4E3E\u62A5\u8005";let A;A="{VAR_PLURAL, plural, =1 {1 \u4E2A\u4E3E\u62A5} other {{INTERPOLATION} \u4E2A\u4E3E\u62A5}}",A=Lt(A,{INTERPOLATION:"\uFFFD1\uFFFD",VAR_PLURAL:"\uFFFD0\uFFFD"});let m;m=""+A+" "+"\uFFFD#2\uFFFD"+""+"\uFFFD/#2\uFFFD"+"";let P;P="\u5DF2\u66F4\u65B0";let N;N="\u4E3E\u62A5\u7684\u90E8\u5206";let D;D="\u6CE8\u610F";let k;k="\u89C6\u9891\u5DF2\u88AB\u5220\u9664";let z;return z="\u8BC4\u8BBA\uFF1A",[s,e,o,d,m,P,N,D,k,z,[1,"d-flex","moderation-expanded"],[1,"left"],["class","d-flex",4,"ngIf"],[1,"mt-3","d-flex"],[1,"moderation-expanded-label"],[1,"ms-1","muted",3,"routerLink","queryParams"],[1,"moderation-expanded-text",3,"innerHTML"],["class","mt-2 d-flex",4,"ngIf"],["class","mt-3 d-flex",4,"ngIf"],[1,"right"],[4,"ngIf"],["class","comment-html",4,"ngIf"],[1,"d-flex"],[1,"moderation-expanded-text"],[1,"chip","me-1",3,"routerLink","queryParams"],["size","18","actorType","account",3,"actor"],[1,"muted"],[1,"ms-auto","muted","abuse-details-links",3,"routerLink","queryParams"],["iconName","flag"],["class","ms-auto muted abuse-details-links",3,"routerLink","queryParams",4,"ngIf"],[1,"moderation-expanded-text","abuse-details-date-updated"],[1,"mt-2","d-flex"],["class","pt-badge badge-secondary",3,"routerLink","queryParams",4,"ngFor","ngForOf"],[1,"pt-badge","badge-secondary",3,"routerLink","queryParams"],[1,"moderation-expanded-text","d-block",3,"innerHTML"],[3,"video",4,"ngIf"],[3,"video"],[1,"comment-html"],[3,"innerHTML"]];},template:function(e,t){e&1&&(r(0,"div",10)(1,"div",11),E(2,qn,12,14,"div",12)(3,Kn,10,8,"div",12)(4,Yn,6,4,"div",12),r(5,"div",13)(6,"span",14),v(7),p(8,0),I(),r(9,"a",15),g(10),a()(),S(11,"span",16),a(),E(12,Zn,3,1,"div",17)(13,to,6,2,"div",17)(14,no,4,1,"div",18),a(),r(15,"div",19),E(16,ro,3,2,"div",20)(17,ao,5,1,"div",21),a()()),e&2&&(i(2),l("ngIf",t.isAdminView&&t.abuse.reporterAccount),i(),l("ngIf",t.abuse.flaggedAccount),i(),l("ngIf",t.abuse.updatedAt),i(5),l("routerLink",ee(12,Ke))("queryParams",h(13,Ye,"#"+t.abuse.id)),i(),b("#",t.abuse.id,""),i(),l("innerHTML",t.abuse.reasonHtml,G),i(),l("ngIf",t.predefinedReasons),i(),l("ngIf",t.abuse.video==null?null:t.abuse.video.startAt),i(),l("ngIf",t.isAdminView&&t.abuse.moderationComment),i(2),l("ngIf",t.abuse.video),i(),l("ngIf",t.abuse.comment));},dependencies:[w,Ct,$e,U,Et,nn,Y],styles:[".moderation-expanded[_ngcontent-%COMP%]{font-size:90%;display:flex;flex-wrap:wrap;justify-content:space-between}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-label[_ngcontent-%COMP%]{font-weight:600;display:inline-block;vertical-align:top;text-align:end;min-width:100px;margin-inline-end:.3125rem}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-text[_ngcontent-%COMP%]{display:inline-flex;word-wrap:break-word}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-text[_ngcontent-%COMP%]     p:last-child{margin-bottom:0!important}.moderation-expanded[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:50%;max-width:500px}@media screen and (max-width: 960px){.moderation-expanded[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:100%}}my-action-dropdown.show[_ngcontent-%COMP%]     .dropdown-root{display:block!important}.table-comment-link[_ngcontent-%COMP%], .table-account-link[_ngcontent-%COMP%]{color:var(--mainForegroundColor)}.table-comment-link[_ngcontent-%COMP%]:focus:not(:focus-visible), .table-account-link[_ngcontent-%COMP%]:focus:not(:focus-visible){outline:none!important}.table-comment-link[_ngcontent-%COMP%]     p:last-child, .table-account-link[_ngcontent-%COMP%]     p:last-child{margin:0}.table-account-link[_ngcontent-%COMP%]{display:flex;flex-direction:column}my-abuse-details[_ngcontent-%COMP%]{width:100%}@media screen and (max-width: 960px){.abuse-messages[_ngcontent-%COMP%]{justify-content:flex-start!important}}",".comment-html[_ngcontent-%COMP%]{background-color:#ececec;padding:10px}.abuse-details-date-updated[_ngcontent-%COMP%]{font-size:90%;margin-top:.1rem}.abuse-details-links[_ngcontent-%COMP%]:hover, .abuse-details-links[_ngcontent-%COMP%]:focus, .abuse-details-links[_ngcontent-%COMP%]:active{text-decoration:none!important}.abuse-details-links[_ngcontent-%COMP%]:focus:not(:focus-visible){outline:none!important}my-global-icon[iconName=flag][_ngcontent-%COMP%]{width:15px}"]}));var It=Qe;var lo=["abuseMessagesModal"],_o=["moderationCommentModal"],co=n=>({show:n});function mo(n,s){if(n&1){let e=y();r(0,"div",24)(1,"div",25)(2,"my-advanced-input-filter",26),M("search",function(o){T(e);let d=c();return f(d.onSearch(o));}),a()()();}if(n&2){let e=c();i(2),l("filters",e.inputFilters);}}function po(n,s){n&1&&(r(0,"th",38),p(1,8),a());}function uo(n,s){n&1&&(r(0,"th",39),p(1,9),a());}function So(n,s){if(n&1&&(r(0,"tr")(1,"th",27)(2,"span",28),p(3,2),a()(),r(4,"th",29)(5,"span",28),p(6,3),a()(),E(7,po,2,0,"th",30),r(8,"th",31),p(9,4),a(),r(10,"th",32),q(11,5),S(12,"p-sortIcon",33),Q(),a(),r(13,"th",34),q(14,6),S(15,"p-sortIcon",35),Q(),a(),r(16,"th",36),p(17,7),a(),E(18,uo,2,0,"th",37),a()),n&2){let e=c();i(7),l("ngIf",e.isAdminView()),i(3),l("ngbTooltip",e.sortTooltip),i(3),l("ngbTooltip",e.sortTooltip),i(5),l("ngIf",e.isAdminView());}}function Ao(n,s){if(n&1&&(r(0,"a",53)(1,"div",54),S(2,"my-actor-avatar",55),r(3,"div"),g(4),r(5,"span"),g(6),a()()()()),n&2){let e=c(2).$implicit;l("href",e.reporterAccount.url,ge),i(2),l("actor",e.reporterAccount),i(2),b(" ",e.reporterAccount.displayName," "),i(2),O(e.reporterAccount.nameWithHost);}}function Eo(n,s){n&1&&(r(0,"span"),p(1,10),a());}function go(n,s){if(n&1&&(r(0,"td"),E(1,Ao,7,4,"a",52)(2,Eo,2,0,"span",44),a()),n&2){let e=c().$implicit;i(),l("ngIf",e.reporterAccount),i(),l("ngIf",!e.reporterAccount);}}function Co(n,s){if(n&1&&(r(0,"span",62),g(1),a()),n&2){let e=c(3).$implicit;i(),kt(" ",e.nth,"/",e.count," ");}}function To(n,s){n&1&&S(0,"my-global-icon",63);}function fo(n,s){if(n&1&&(r(0,"td")(1,"my-video-cell",57)(2,"span",58),E(3,Co,2,2,"span",59),a(),r(4,"span",60),E(5,To,1,0,"my-global-icon",61),a()()()),n&2){let e=c(2).$implicit;i(),l("video",e.video),i(2),l("ngIf",e.count>1),i(2),l("ngIf",e.video.blacklisted);}}function Mo(n,s){if(n&1&&(r(0,"td",45)(1,"div",64)(2,"div",65)(3,"div"),g(4),r(5,"span",66),p(6,11),a()(),r(7,"div",67),p(8,12),a()()()()),n&2){let e=c(2).$implicit;l("pRowToggler",e),i(4),b(" ",e.video.name," "),i(4),Ce(e.video.channel==null?null:e.video.channel.displayName)(e.video.channel==null?null:e.video.channel.host),Te(8);}}function Ro(n,s){if(n&1&&(v(0),E(1,fo,6,3,"td",44)(2,Mo,9,4,"td",56),I()),n&2){let e=c().$implicit;i(),l("ngIf",!e.video.deleted),i(),l("ngIf",e.video.deleted);}}function Oo(n,s){if(n&1&&(r(0,"div",70),g(1),a()),n&2){let e=c(2).$implicit;i(),b("by ",e.flaggedAccount.displayName,"");}}function No(n,s){if(n&1&&(v(0),r(1,"td"),S(2,"a",68),E(3,Oo,2,1,"div",69),a(),I()),n&2){let e=c().$implicit,t=c();i(2),l("href",t.getCommentUrl(e),ge)("innerHTML",e.commentHTML,G)("title",e.comment.video.name),i(),l("ngIf",e.flaggedAccount);}}function ho(n,s){if(n&1&&(r(0,"td")(1,"a",71)(2,"span"),g(3),a(),r(4,"span",72),g(5),a()()()),n&2){let e=c(2).$implicit,t=c();i(),l("href",t.getAccountUrl(e),ge),i(2),O(e.flaggedAccount.displayName),i(2),O(e.flaggedAccount.nameWithHostForced);}}function bo(n,s){n&1&&(r(0,"td"),p(1,13),a());}function Do(n,s){if(n&1&&(v(0),E(1,ho,6,3,"td",44)(2,bo,2,0,"td",44),I()),n&2){let e=c().$implicit;i(),l("ngIf",e.flaggedAccount),i(),l("ngIf",!e.flaggedAccount);}}function vo(n,s){if(n&1&&(r(0,"div",73),S(1,"my-global-icon",74),a()),n&2){let e=c().$implicit;l("title",e.state.label);}}function Io(n,s){if(n&1&&(r(0,"div",75),S(1,"my-global-icon",76),a()),n&2){let e=c().$implicit;l("title",e.state.label);}}function Po(n,s){if(n&1){let e=y();r(0,"button",77),M("click",function(){T(e);let o=c().$implicit,d=c();return f(d.openAbuseMessagesModal(o));}),g(1),S(2,"my-global-icon",78),a();}if(n&2){let e=c().$implicit,t=c();l("ariaLabel",t.getSendMessageButtonLabel(e))("title",t.getSendMessageButtonLabel(e)),i(),b(" ",e.countMessages," ");}}function Lo(n,s){if(n&1&&(r(0,"td",79),g(1),a()),n&2){let e=c().$implicit;l("ngbTooltip",e.moderationComment),i(),b(" ",e.moderationComment," ");}}function yo(n,s){if(n&1&&(r(0,"tr")(1,"td",40),S(2,"my-table-expander-icon",41),a(),r(3,"td",42),S(4,"my-action-dropdown",43),a(),E(5,go,3,2,"td",44)(6,Ro,3,2,"ng-container",44)(7,No,4,4,"ng-container",44)(8,Do,3,2,"ng-container",44),r(9,"td",45),g(10),K(11,"date"),a(),r(12,"td",46),E(13,vo,2,1,"div",47)(14,Io,2,1,"div",48),a(),r(15,"td",49),E(16,Po,3,3,"button",50),a(),E(17,Lo,2,2,"td",51),a()),n&2){let e=s.expanded,t=s.$implicit,o=c();i(2),l("pRowToggler",t)("expanded",e),i(2),l("ngClass",h(19,co,e))("actions",o.abuseActions)("entry",t),i(),l("ngIf",o.isAdminView()),i(),l("ngIf",t.video),i(),l("ngIf",t.comment),i(),l("ngIf",!t.comment&&!t.video),i(),l("pRowToggler",t),i(),O(re(11,16,t.createdAt,"short")),i(2),l("pRowToggler",t),i(),l("ngIf",o.isAbuseAccepted(t)),i(),l("ngIf",o.isAbuseRejected(t)),i(2),l("ngIf",o.isLocalAbuse(t)),i(),l("ngIf",o.isAdminView());}}function xo(n,s){if(n&1&&(r(0,"td",81),S(1,"my-abuse-details",82),a()),n&2){let e=c().$implicit;i(),l("abuse",e)("isAdminView",!0);}}function $o(n,s){if(n&1&&(r(0,"td",81),S(1,"my-abuse-details",82),a()),n&2){let e=c().$implicit;i(),l("abuse",e)("isAdminView",!1);}}function wo(n,s){if(n&1&&(r(0,"tr"),E(1,xo,2,2,"td",80)(2,$o,2,2,"td",80),a()),n&2){let e=c();i(),l("ngIf",e.isAdminView()),i(),l("ngIf",!e.isAdminView());}}function Ho(n,s){n&1&&(v(0),p(1,14),I());}function Fo(n,s){n&1&&(v(0),p(1,15),I());}function Wo(n,s){if(n&1&&(r(0,"tr")(1,"td",83)(2,"div",84),E(3,Ho,2,0,"ng-container",44)(4,Fo,2,0,"ng-container",44),a()()()),n&2){let e=c();i(3),l("ngIf",e.search),i(),l("ngIf",!e.search);}}var Bo=(0,Rn.default)("peertube:moderation:AbuseListTableComponent"),Je=class Je extends J{constructor(e,t,o,d,A,m,P,N,D,k){super();this.route=e;this.router=t;this.notifier=o;this.abuseService=d;this.blocklistService=A;this.commentService=m;this.videoService=P;this.videoBlocklistService=N;this.confirmService=D;this.markdownRenderer=k;_(this,"viewType");_(this,"abuseMessagesModal");_(this,"moderationCommentModal");_(this,"abuses",[]);_(this,"totalRecords",0);_(this,"sort",{field:"createdAt",order:1});_(this,"pagination",{count:this.rowsPerPage,start:0});_(this,"abuseActions",[]);_(this,"inputFilters",[{title:"\u9AD8\u7EA7\u8FC7\u6EE4",children:[{value:"state:pending",label:"\u672A\u89E3\u51B3\u7684\u4E3E\u62A5"},{value:"state:accepted",label:"\u5DF2\u63A5\u53D7\u7684\u4E3E\u62A5"},{value:"state:rejected",label:"\u5DF2\u62D2\u7EDD\u7684\u4E3E\u62A5"},{value:"videoIs:blacklisted",label:"\u5E26\u5C4F\u853D\u89C6\u9891\u7684\u4E3E\u62A5"},{value:"videoIs:deleted",label:"\u5E26\u5220\u9664\u89C6\u9891\u7684\u4E3E\u62A5"}]}]);}ngOnInit(){this.abuseActions=[this.buildInternalActions(),this.buildFlaggedAccountActions(),this.buildCommentActions(),this.buildVideoActions(),this.buildAccountActions()],this.initialize();}isAdminView(){return this.viewType==="admin";}getIdentifier(){return"AbuseListTableComponent";}openModerationCommentModal(e){this.moderationCommentModal.openModal(e);}onModerationCommentUpdated(){this.reloadData();}isAbuseAccepted(e){return e.state.id===te.ACCEPTED;}isAbuseRejected(e){return e.state.id===te.REJECTED;}getVideoUrl(e){return xt.buildWatchUrl(e.video);}getCommentUrl(e){return xt.buildWatchUrl(e.comment.video)+";threadId="+e.comment.threadId;}getAccountUrl(e){return"/a/"+e.flaggedAccount.nameWithHost;}removeAbuse(e){return j(this,null,function*(){(yield this.confirmService.confirm("\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u6EE5\u7528\u884C\u4E3A\u4E3E\u62A5\u5417\uFF1F","\u5220\u9664"))!==!1&&this.abuseService.removeAbuse(e).subscribe({next:()=>{this.notifier.success("\u4E3E\u62A5\u8BB0\u5F55\u5DF2\u5220\u9664\u3002"),this.reloadData();},error:o=>this.notifier.error(o.message)});});}updateAbuseState(e,t){this.abuseService.updateAbuse(e,{state:t}).subscribe({next:()=>this.reloadData(),error:o=>this.notifier.error(o.message)});}onCountMessagesUpdated(e){let t=this.abuses.find(o=>o.id===e.abuseId);if(!t){Tt.error(`Cannot find abuse ${e.abuseId}`);return;}t.countMessages=e.countMessages;}openAbuseMessagesModal(e){this.abuseMessagesModal.openModal(e);}isLocalAbuse(e){return this.viewType==="user"?!0:e.reporterAccount?Yt.IS_LOCAL(e.reporterAccount.host):!1;}getSendMessageButtonLabel(e){return this.viewType==="admin"?Pe("Send a message to the reporter (currently {count, plural, =1 {{count} message} other {{count} messages}})",{count:e.countMessages}):Pe("Send a message to the admins/moderators (currently {count, plural, =1 {{count} message} other {{count} messages}})",{count:e.countMessages});}reloadDataInternal(){Bo("Loading data.");let e={pagination:this.pagination,sort:this.sort,search:this.search};return(this.viewType==="admin"?this.abuseService.getAdminAbuses(e):this.abuseService.getUserAbuses(e)).subscribe({next:o=>j(this,null,function*(){var d;this.totalRecords=o.total,this.abuses=[];for(let A of o.data){let m=A;m.reasonHtml=yield this.toHtml(m.reason),m.moderationComment&&(m.moderationCommentHtml=yield this.toHtml(m.moderationComment)),m.video&&(d=m.video.channel)!=null&&d.ownerAccount&&(m.video.channel.ownerAccount=new ft(m.video.channel.ownerAccount)),m.comment&&(m.comment.deleted?m.commentHTML="\u5DF2\u5220\u9664\u8BC4\u8BBA":m.commentHTML=yield this.markdownRenderer.textMarkdownToHTML({markdown:m.comment.text,withHtml:!0})),m.reporterAccount&&(m.reporterAccount=new ft(m.reporterAccount)),m.flaggedAccount&&(m.flaggedAccount=new ft(m.flaggedAccount)),m.updatedAt===m.createdAt&&delete m.updatedAt,this.abuses.push(m);}}),error:o=>this.notifier.error(o.message)});}buildInternalActions(){return[{label:"\u5185\u90E8\u64CD\u4F5C",isHeader:!0},{label:this.isAdminView()?"\u4E0E\u4E3E\u62A5\u8005\u95F4\u7684\u6D88\u606F":"\u4E0E\u7248\u4E3B\u95F4\u7684\u6D88\u606F",handler:e=>this.openAbuseMessagesModal(e),isDisplayed:e=>this.isLocalAbuse(e)},{label:"\u66F4\u65B0\u5185\u90E8\u8BF4\u660E",handler:e=>this.openModerationCommentModal(e),isDisplayed:e=>this.isAdminView()&&!!e.moderationComment},{label:"\u6807\u8BB0\u4E3A\u5DF2\u63A5\u53D7",handler:e=>this.updateAbuseState(e,te.ACCEPTED),isDisplayed:e=>this.isAdminView()&&!this.isAbuseAccepted(e)},{label:"\u6807\u8BB0\u4E3A\u5DF2\u62D2\u7EDD",handler:e=>this.updateAbuseState(e,te.REJECTED),isDisplayed:e=>this.isAdminView()&&!this.isAbuseRejected(e)},{label:"\u6DFB\u52A0\u5185\u90E8\u8BF4\u660E",handler:e=>this.openModerationCommentModal(e),isDisplayed:e=>this.isAdminView()&&!e.moderationComment},{label:"\u5220\u9664\u4E3E\u62A5",handler:e=>this.removeAbuse(e),isDisplayed:()=>this.isAdminView()}];}buildFlaggedAccountActions(){return this.isAdminView()?[{label:"\u53D7\u6807\u8BB0\u5E10\u6237\u7684\u64CD\u4F5C",isHeader:!0,isDisplayed:e=>e.flaggedAccount&&!e.comment&&!e.video},{label:"\u9690\u85CF\u5E10\u6237",isDisplayed:e=>e.flaggedAccount&&!e.comment&&!e.video,handler:e=>this.muteAccountHelper(e.flaggedAccount)},{label:"\u9690\u85CF\u670D\u52A1\u5668\u5E10\u6237",isDisplayed:e=>e.flaggedAccount&&!e.comment&&!e.video,handler:e=>this.muteServerHelper(e.flaggedAccount.host)}]:[];}buildAccountActions(){return this.isAdminView()?[{label:"\u4E3E\u62A5\u64CD\u4F5C",isHeader:!0,isDisplayed:e=>!!e.reporterAccount},{label:"\u9690\u85CF\u4E3E\u62A5\u8005",isDisplayed:e=>!!e.reporterAccount,handler:e=>this.muteAccountHelper(e.reporterAccount)},{label:"\u9690\u85CF\u670D\u52A1\u5668",isDisplayed:e=>e.reporterAccount&&!e.reporterAccount.userId,handler:e=>this.muteServerHelper(e.reporterAccount.host)}]:[];}buildVideoActions(){return this.isAdminView()?[{label:"\u89C6\u9891\u7684\u64CD\u4F5C",isHeader:!0,isDisplayed:e=>e.video&&!e.video.deleted},{label:"\u5C4F\u853D\u89C6\u9891",isDisplayed:e=>e.video&&!e.video.deleted&&!e.video.blacklisted,handler:e=>{this.videoBlocklistService.blockVideo([{videoId:e.video.id,unfederate:e.video.channel.isLocal}]).subscribe({next:()=>{this.notifier.success("\u89C6\u9891\u5DF2\u5C4F\u853D\u3002"),this.updateAbuseState(e,te.ACCEPTED);},error:t=>this.notifier.error(t.message)});}},{label:"\u53D6\u6D88\u5C4F\u853D\u89C6\u9891",isDisplayed:e=>e.video&&!e.video.deleted&&e.video.blacklisted,handler:e=>{this.videoBlocklistService.unblockVideo(e.video.id).subscribe({next:()=>{this.notifier.success("\u89C6\u9891\u5DF2\u89E3\u9664\u5C4F\u853D\u3002"),this.updateAbuseState(e,te.ACCEPTED);},error:t=>this.notifier.error(t.message)});}},{label:"\u5220\u9664\u89C6\u9891",isDisplayed:e=>e.video&&!e.video.deleted,handler:e=>j(this,null,function*(){(yield this.confirmService.confirm("\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u89C6\u9891\u5417\uFF1F","\u5220\u9664"))!==!1&&this.videoService.removeVideo(e.video.id).subscribe({next:()=>{this.notifier.success("\u89C6\u9891\u5DF2\u5220\u9664\u3002"),this.updateAbuseState(e,te.ACCEPTED);},error:o=>this.notifier.error(o.message)});})}]:[];}buildCommentActions(){return this.isAdminView()?[{label:"\u8BC4\u8BBA\u64CD\u4F5C",isHeader:!0,isDisplayed:e=>e.comment&&!e.comment.deleted},{label:"\u5220\u9664\u8BC4\u8BBA",isDisplayed:e=>e.comment&&!e.comment.deleted,handler:e=>j(this,null,function*(){(yield this.confirmService.confirm("\u4F60\u771F\u7684\u60F3\u5220\u9664\u8FD9\u6761\u8BC4\u8BBA\u5417\uFF1F","\u5220\u9664"))!==!1&&this.commentService.deleteVideoComment(e.comment.video.id,e.comment.id).subscribe({next:()=>{this.notifier.success("\u8BC4\u8BBA\u5DF2\u5220\u9664\u3002"),this.updateAbuseState(e,te.ACCEPTED);},error:o=>this.notifier.error(o.message)});})}]:[];}muteAccountHelper(e){this.blocklistService.blockAccountByInstance(e).subscribe({next:()=>{this.notifier.success("\u5E10\u6237 "+e.nameWithHost+" \u5DF2\u88AB\u672C\u5B9E\u4F8B\u9690\u85CF\u3002"),e.mutedByInstance=!0;},error:t=>this.notifier.error(t.message)});}muteServerHelper(e){this.blocklistService.blockServerByInstance(e).subscribe({next:()=>{this.notifier.success("\u670D\u52A1\u5668 "+e+" \u5DF2\u88AB\u672C\u5B9E\u4F8B\u9690\u85CF\u3002");},error:t=>this.notifier.error(t.message)});}toHtml(e){return this.markdownRenderer.textMarkdownToHTML({markdown:e});}};_(Je,"\u0275fac",function(t){return new(t||Je)(u(Oe),u(Ne),u(H),u(He),u(Fe),u(bt),u(rn),u(on),u(ye),u(Rt));}),_(Je,"\u0275cmp",x({type:Je,selectors:[["my-abuse-list-table"]],viewQuery:function(t,o){if(t&1&&(F(lo,7),F(_o,7)),t&2){let d;W(d=B())&&(o.abuseMessagesModal=d.first),W(d=B())&&(o.moderationCommentModal=d.first);}},inputs:{viewType:"viewType"},standalone:!0,features:[L,$],decls:10,vars:15,consts:()=>{let e;e="\u66F4\u591A\u4FE1\u606F";let t;t="\u64CD\u4F5C";let o;o="\u89C6\u9891/\u8BC4\u8BBA/\u5E10\u6237";let d;d="\u521B\u5EFA\u65F6\u95F4 "+"\uFFFD#12\uFFFD"+""+"\uFFFD/#12\uFFFD"+"";let A;A="\u72B6\u6001 "+"\uFFFD#15\uFFFD"+""+"\uFFFD/#15\uFFFD"+"";let m;m="\u6D88\u606F";let P;P="\u4E3E\u62A5\u8005";let N;N="\u5185\u90E8\u8BF4\u660E";let D;D="\u64CD\u4F5C";let k;k="\u5728\u65B0\u6807\u7B7E\u9875\u4E2D\u6253\u5F00\u5E10\u6237";let z;z="\u5DF2\u5220\u9664\u5E10\u6237";let R;R="\u6B64\u89C6\u9891\u5DF2\u88AB\u591A\u6B21\u4E3E\u62A5\u3002";let Re;Re="\u6B64\u89C6\u9891\u5DF2\u88AB\u5C4F\u853D";let rt;rt="\u89C6\u9891\u5DF2\u88AB\u5220\u9664";let at;at="(Deleted video)";let st;st="\u7531 "+"\uFFFD0\uFFFD"+" \u4E8E "+"\uFFFD1\uFFFD"+" ";let lt;lt="\u5E10\u6237\u5DF2\u5220\u9664";let _t;_t="\u6CA1\u6709\u627E\u5230\u4E0E\u5F53\u524D\u8FC7\u6EE4\u5668\u5339\u914D\u7684\u6EE5\u7528\u884C\u4E3A\u3002";let dt;return dt="\u6CA1\u6709\u627E\u5230\u6EE5\u7528\u884C\u4E3A\u3002",[["moderationCommentModal",""],["abuseMessagesModal",""],e,t,o,d,A,m,P,N,z,at,st,lt,_t,dt,["dataKey","id",3,"onLazyLoad","value","paginator","totalRecords","rows","first","rowsPerPageOptions","sortField","sortOrder","resizableColumns","lazy","lazyLoadOnInit","showCurrentPageReport","currentPageReportTemplate","expandedRowKeys"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","emptymessage"],[3,"commentUpdated"],[3,"countMessagesUpdated","isAdminView"],[1,"caption"],[1,"ms-auto"],[3,"search","filters"],["scope","col",2,"width","40px"],[1,"visually-hidden"],["scope","col",2,"width","150px"],["scope","col","style","width: 20%;","pResizableColumn","",4,"ngIf"],["scope","col"],["scope","col","container","body","pSortableColumn","createdAt",2,"width","150px",3,"ngbTooltip"],["field","createdAt"],["scope","col","container","body","pSortableColumn","state",2,"width","80px",3,"ngbTooltip"],["field","state"],["scope","col",2,"width","80px"],["scope","col","style","width: 100px;",4,"ngIf"],["scope","col","pResizableColumn","",2,"width","20%"],["scope","col",2,"width","100px"],[1,"expand-cell"],[3,"pRowToggler","expanded"],[1,"action-cell"],["placement","bottom-right top-right left auto","container","body","label",D,3,"ngClass","actions","entry"],[4,"ngIf"],[1,"c-hand",3,"pRowToggler"],[1,"c-hand","abuse-states",3,"pRowToggler"],["class","pt-badge badge-success",3,"title",4,"ngIf"],["class","pt-badge badge-danger",3,"title",4,"ngIf"],[1,"abuse-messages"],["class","peertube-button grey-button",3,"ariaLabel","title","click",4,"ngIf"],["class","internal-note","container","body","placement","left auto",3,"ngbTooltip",4,"ngIf"],["title",k,"target","_blank","rel","noopener noreferrer",3,"href",4,"ngIf"],["title",k,"target","_blank","rel","noopener noreferrer",3,"href"],[1,"chip","two-lines"],["actorType","account","size","32",3,"actor"],["class","c-hand",3,"pRowToggler",4,"ngIf"],[3,"video"],["image",""],["class","table-video-image-label","title",R,4,"ngIf"],["name",""],["iconName","no","title",Re,4,"ngIf"],["title",R,1,"table-video-image-label"],["iconName","no","title",Re],["title",rt,1,"table-video"],[1,"table-video-text"],[1,"fst-italic"],[1,"video-owner"],["target","_blank","rel","noopener noreferrer",1,"table-comment-link","ellipsis-multiline-1",3,"href","innerHTML","title"],["class","comment-flagged-account",4,"ngIf"],[1,"comment-flagged-account"],["target","_blank","rel","noopener noreferrer",1,"table-account-link",3,"href"],[1,"account-flagged-handle"],[1,"pt-badge","badge-success",3,"title"],["iconName","tick"],[1,"pt-badge","badge-danger",3,"title"],["iconName","cross"],[1,"peertube-button","grey-button",3,"click","ariaLabel","title"],["aria-","","iconName","message-circle"],["container","body","placement","left auto",1,"internal-note",3,"ngbTooltip"],["class","expand-cell","myAutoColspan","",4,"ngIf"],["myAutoColspan","",1,"expand-cell"],[3,"abuse","isAdminView"],["myAutoColspan",""],[1,"no-results"]];},template:function(t,o){if(t&1){let d=y();r(0,"p-table",16),M("onLazyLoad",function(m){return T(d),f(o.loadLazy(m));}),E(1,mo,3,1,"ng-template",17)(2,So,19,4,"ng-template",18)(3,yo,18,21,"ng-template",19)(4,wo,3,2,"ng-template",20)(5,Wo,5,2,"ng-template",21),a(),r(6,"my-moderation-comment-modal",22,0),M("commentUpdated",function(){return T(d),f(o.onModerationCommentUpdated());}),a(),r(8,"my-abuse-message-modal",23,1),M("countMessagesUpdated",function(m){return T(d),f(o.onCountMessagesUpdated(m));}),a();}t&2&&(l("value",o.abuses)("paginator",o.totalRecords>0)("totalRecords",o.totalRecords)("rows",o.rowsPerPage)("first",o.pagination.start)("rowsPerPageOptions",o.rowsPerPageOptions)("sortField",o.sort.field)("sortOrder",o.sort.order)("resizableColumns",!0)("lazy",!0)("lazyLoadOnInit",!1)("showCurrentPageReport",!0)("currentPageReportTemplate",o.getPaginationTemplate())("expandedRowKeys",o.expandedRows),i(8),l("isAdminView",o.isAdminView()));},dependencies:[Ge,Ve,ve,Ue,ze,ln,ke,Ie,ht,w,De,Be,we,V,$e,an,U,We,It,vt,Dt,Y],styles:[".moderation-expanded[_ngcontent-%COMP%]{font-size:90%;display:flex;flex-wrap:wrap;justify-content:space-between}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-label[_ngcontent-%COMP%]{font-weight:600;display:inline-block;vertical-align:top;text-align:end;min-width:100px;margin-inline-end:.3125rem}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-text[_ngcontent-%COMP%]{display:inline-flex;word-wrap:break-word}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-text[_ngcontent-%COMP%]     p:last-child{margin-bottom:0!important}.moderation-expanded[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:50%;max-width:500px}@media screen and (max-width: 960px){.moderation-expanded[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:100%}}my-action-dropdown.show[_ngcontent-%COMP%]     .dropdown-root{display:block!important}.table-comment-link[_ngcontent-%COMP%], .table-account-link[_ngcontent-%COMP%]{color:var(--mainForegroundColor)}.table-comment-link[_ngcontent-%COMP%]:focus:not(:focus-visible), .table-account-link[_ngcontent-%COMP%]:focus:not(:focus-visible){outline:none!important}.table-comment-link[_ngcontent-%COMP%]     p:last-child, .table-account-link[_ngcontent-%COMP%]     p:last-child{margin:0}.table-account-link[_ngcontent-%COMP%]{display:flex;flex-direction:column}my-abuse-details[_ngcontent-%COMP%]{width:100%}@media screen and (max-width: 960px){.abuse-messages[_ngcontent-%COMP%]{justify-content:flex-start!important}}",".comment-flagged-account[_ngcontent-%COMP%], .account-flagged-handle[_ngcontent-%COMP%], .video-owner[_ngcontent-%COMP%]{font-size:11px;color:var(--greyForegroundColor)}.abuse-messages[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{width:22px;position:relative;top:-2px;margin-inline-start:.1875rem}.table-video-text[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%], my-video-cell[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{width:15px;position:relative;top:-2px}"]}));var gn=Je;var Ze=class Ze extends J{constructor(e,t){super();this.notifier=e;this.blocklistService=t;_(this,"blockedAccounts",[]);_(this,"totalRecords",0);_(this,"sort",{field:"createdAt",order:-1});_(this,"pagination",{count:this.rowsPerPage,start:0});}ngOnInit(){this.initialize();}unblockAccount(e){let t=e.blockedAccount;(this.mode===0?this.blocklistService.unblockAccountByUser(t):this.blocklistService.unblockAccountByInstance(t)).subscribe(()=>{this.notifier.success(this.mode===0?"\u5DF2\u89E3\u9664\u5BF9\u5E10\u6237 "+t.nameWithHost+" \u7684\u9690\u85CF\u3002":"\u5DF2\u89E3\u9664\u5728\u6B64\u5B9E\u4F8B\u4E0A\u5BF9\u5E10\u6237 "+t.nameWithHost+" \u7684\u9690\u85CF\u3002"),this.reloadData();});}reloadDataInternal(){return(this.mode===0?this.blocklistService.getUserAccountBlocklist({pagination:this.pagination,sort:this.sort,search:this.search}):this.blocklistService.getInstanceAccountBlocklist({pagination:this.pagination,sort:this.sort,search:this.search})).subscribe({next:t=>{this.blockedAccounts=t.data,this.totalRecords=t.total;},error:t=>this.notifier.error(t.message)});}};_(Ze,"\u0275fac",function(t){return new(t||Ze)(u(H),u(Fe));}),_(Ze,"\u0275dir",pt({type:Ze,features:[L]}));var On=Ze;var Uo=["modal"],ko=[[["warning"]]],zo=["warning"],Go=n=>({"input-error":n});function Xo(n,s){if(n&1&&(r(0,"div"),g(1),a()),n&2){let e=c(3);i(),b(" ",e.form.controls.hosts.errors.validHosts.value," ");}}function jo(n,s){if(n&1&&(r(0,"div",15),g(1),E(2,Xo,2,1,"div",16),a()),n&2){let e=c(2);i(),b(" ",e.formErrors.hosts," "),i(),l("ngIf",e.form.controls.hosts.errors.validHosts);}}function qo(n,s){if(n&1){let e=y();r(0,"div",2)(1,"h4",3),g(2),a(),r(3,"button",4),M("click",function(){T(e);let o=c();return f(o.hide());}),S(4,"my-global-icon",5),a()(),r(5,"div",6)(6,"form",7),M("ngSubmit",function(){T(e);let o=c();return f(o.submit());}),r(7,"div",8)(8,"label",9),p(9,1),a(),S(10,"textarea",10),E(11,jo,3,2,"div",11),a(),Ut(12),r(13,"div",12)(14,"input",13),M("click",function(){T(e);let o=c();return f(o.hide());})("key.enter",function(){T(e);let o=c();return f(o.hide());}),a(),S(15,"input",14),a()()();}if(n&2){let e=c();i(2),O(e.action),i(4),l("formGroup",e.form),i(4),l("placeholder",e.placeholder)("ngClass",h(7,Go,e.formErrors.hosts)),i(),l("ngIf",e.formErrors.hosts),i(4),l("value",e.action)("disabled",!e.form.valid);}}var et=class et extends Ae{constructor(e,t){super();this.formReactiveService=e;this.modalService=t;_(this,"modal");_(this,"placeholder","example.com");_(this,"action");_(this,"domains",new ie());_(this,"openedModal");}ngOnInit(){this.action||(this.action="\u5904\u7406\u57DF"),this.buildForm({hosts:pn});}openModal(){this.openedModal=this.modalService.open(this.modal,{centered:!0});}hide(){this.openedModal.close();}submit(){this.domains.emit(Le(this.form.controls.hosts.value)),this.form.reset(),this.hide();}};_(et,"\u0275fac",function(t){return new(t||et)(u(ue),u(Se));}),_(et,"\u0275cmp",x({type:et,selectors:[["my-batch-domains-modal"]],viewQuery:function(t,o){if(t&1&&F(Uo,7),t&2){let d;W(d=B())&&(o.modal=d.first);}},inputs:{placeholder:"placeholder",action:"action"},outputs:{domains:"domains"},standalone:!0,features:[L,$],ngContentSelectors:zo,decls:2,vars:0,consts:()=>{let e;e="Close this modal";let t;t="\u53D6\u6D88";let o;return o="\u6BCF\u884C\u4E00\u4E2A\u4E3B\u673A\u540D\uFF08\u4E0D\u5E26\u201Chttp://\u201D\uFF09",[["modal",""],o,[1,"modal-header"],[1,"modal-title"],["title",e,1,"border-0","p-0",3,"click"],["iconName","cross"],[1,"modal-body"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-group"],["for","hosts"],["formControlName","hosts","type","text","id","hosts","name","hosts","ngbAutofocus","",1,"form-control",3,"placeholder","ngClass"],["class","form-error","role","alert",4,"ngIf"],[1,"form-group","inputs"],["type","button","role","button","value",t,1,"peertube-button","grey-button",3,"click","key.enter"],["type","submit",1,"peertube-button","orange-button",3,"value","disabled"],["role","alert",1,"form-error"],[4,"ngIf"]];},template:function(t,o){t&1&&(Vt(ko),E(0,qo,16,9,"ng-template",null,0,ae));},dependencies:[U,me,he,se,le,_e,pe,de,ce,V,w],styles:["textarea[_ngcontent-%COMP%]{height:200px}"]}));var Nn=et;var Qo=["batchDomainsModal"],tt=class tt extends J{constructor(e,t){super();this.notifier=e;this.blocklistService=t;_(this,"batchDomainsModal");_(this,"blockedServers",[]);_(this,"totalRecords",0);_(this,"sort",{field:"createdAt",order:-1});_(this,"pagination",{count:this.rowsPerPage,start:0});}ngOnInit(){this.initialize();}unblockServer(e){let t=d=>this.mode===0?this.blocklistService.unblockServerByUser(d):this.blocklistService.unblockServerByInstance(d),o=e.blockedServer.host;t(o).subscribe(()=>{this.notifier.success(this.mode===0?"\u5DF2\u89E3\u9664\u5BF9\u5B9E\u4F8B "+o+" \u7684\u9690\u85CF\u3002":"\u5DF2\u89E3\u9664\u5728\u6B64\u5B9E\u4F8B\u4E0A\u5BF9\u5B9E\u4F8B "+o+" \u7684\u9690\u85CF\u3002"),this.reloadData();});}addServersToBlock(){this.batchDomainsModal.openModal();}onDomainsToBlock(e){let t=o=>this.mode===0?this.blocklistService.blockServerByUser(o):this.blocklistService.blockServerByInstance(o);e.forEach(o=>{t(o).subscribe(()=>{this.notifier.success(this.mode===0?"\u5DF2\u9690\u85CF\u5B9E\u4F8B "+o+"\u3002 ":"\u5DF2\u5728\u6B64\u5B9E\u4F8B\u4E0A\u5BF9 "+o+" \u8FDB\u884C\u9690\u85CF\u3002"),this.reloadData();});});}reloadDataInternal(){return(this.mode===0?this.blocklistService.getUserServerBlocklist({pagination:this.pagination,sort:this.sort,search:this.search}):this.blocklistService.getInstanceServerBlocklist({pagination:this.pagination,sort:this.sort,search:this.search})).subscribe({next:t=>{this.blockedServers=t.data,this.totalRecords=t.total;},error:t=>this.notifier.error(t.message)});}};_(tt,"\u0275fac",function(t){return new(t||tt)(u(H),u(Fe));}),_(tt,"\u0275dir",pt({type:tt,viewQuery:function(t,o){if(t&1&&F(Qo,5),t&2){let d;W(d=B())&&(o.batchDomainsModal=d.first);}},features:[L]}));var hn=tt;var Ko=n=>{if(!n.value)return null;let s=[],e=Le(n.value);for(let t of e)(t.length<1||t.length>100)&&s.push(""+t+" is not valid (min 1 character/max 100 characters)");return e.length>500&&s.push("There are too much words in the list (max 500 words)"),s.length===0?null:{validWords:{reason:"invalid",value:s.join(". ")+"."}};},bn={VALIDATORS:[ct.required,ct.minLength(1),ct.maxLength(100)],MESSAGES:{required:"List name is required.",minlength:"List name must be at least 1 character long.",maxlength:"List name cannot be more than 100 characters long."}},Dn={VALIDATORS:[ct.required,mn,Ko],MESSAGES:{required:"Words are required.",unique:"Words entered contain duplicates.",validWords:"A word must be between 1 and 100 characters and the total number of words must not exceed 500 items"}};var Yo=["modal"],vn=n=>({"input-error":n});function Jo(n,s){if(n&1&&(r(0,"div",21),g(1),a()),n&2){let e=c(2);i(),O(e.formErrors.listName);}}function Zo(n,s){if(n&1&&(r(0,"div",21),g(1),a()),n&2){let e=c(2);i(),O(e.formErrors.words);}}function ei(n,s){if(n&1){let e=y();v(0,5),r(1,"div",6)(2,"h4",7),p(3,1),a(),r(4,"button",8),M("click",function(){T(e);let o=c();return f(o.hide());}),S(5,"my-global-icon",9),a()(),r(6,"div",10)(7,"div",11)(8,"label",12),p(9,2),a(),S(10,"input",13),E(11,Jo,2,1,"div",14),a(),r(12,"div",11)(13,"label",15),p(14,3),a(),r(15,"div",16),p(16,4),a(),S(17,"textarea",17),E(18,Zo,2,1,"div",14),a()(),r(19,"div",18)(20,"input",19),M("click",function(){T(e);let o=c();return f(o.hide());})("key.enter",function(){T(e);let o=c();return f(o.hide());}),a(),r(21,"input",20),M("click",function(){T(e);let o=c();return f(o.addOrUpdate());}),a()(),I();}if(n&2){let e=c();l("formGroup",e.form),i(10),l("ngClass",h(6,vn,e.formErrors.listName)),i(),l("ngIf",e.formErrors.listName),i(6),l("ngClass",h(8,vn,e.formErrors.words)),i(),l("ngIf",e.formErrors.words),i(3),l("disabled",!e.form.valid);}}var nt=class nt extends Ae{constructor(e,t,o,d){super();this.formReactiveService=e;this.modalService=t;this.notifier=o;this.watchedWordsService=d;_(this,"accountName");_(this,"listAddedOrUpdated",new ie());_(this,"modal");_(this,"openedModal");_(this,"listToUpdate");}ngOnInit(){this.buildForm({listName:bn,words:Dn});}show(e){this.listToUpdate=e,this.openedModal=this.modalService.open(this.modal,{centered:!0,keyboard:!1}),e&&this.form.patchValue({listName:e.listName,words:e.words.join(`
`)});}hide(){this.openedModal.close(),this.form.reset(),this.listToUpdate=void 0;}addOrUpdate(){let e={accountName:this.accountName,listName:this.form.value.listName,words:Le(this.form.value.words)};(this.listToUpdate?this.watchedWordsService.updateList(Wt(Ft({},e),{listId:this.listToUpdate.id})):this.watchedWordsService.addList(e)).subscribe({next:()=>{this.listToUpdate?this.notifier.success(""+e.listName+" updated"):this.notifier.success(""+e.listName+" created"),this.listAddedOrUpdated.emit();},error:o=>this.notifier.error(o.message)}),this.hide();}};_(nt,"\u0275fac",function(t){return new(t||nt)(u(ue),u(Se),u(H),u(Xe));}),_(nt,"\u0275cmp",x({type:nt,selectors:[["my-watched-words-list-save-modal"]],viewQuery:function(t,o){if(t&1&&F(Yo,7),t&2){let d;W(d=B())&&(o.modal=d.first);}},inputs:{accountName:"accountName"},outputs:{listAddedOrUpdated:"listAddedOrUpdated"},standalone:!0,features:[L,$],decls:2,vars:0,consts:()=>{let e;e="Close this modal";let t;t="\u53D6\u6D88";let o;o="\u4FDD\u5B58";let d;d="Save watched words list";let A;A="List name";let m;m="Words";let P;return P="One word or group of words per line.",[["modal",""],d,A,m,P,[3,"formGroup"],[1,"modal-header"],[1,"modal-title"],["title",e,1,"border-0","p-0",3,"click"],["iconName","cross"],[1,"modal-body"],[1,"form-group"],["for","listName"],["type","text","id","listName","formControlName","listName",1,"form-control",3,"ngClass"],["class","form-error","role","alert",4,"ngIf"],["for","words"],[1,"form-group-description"],["id","words","formControlName","words",1,"form-control",3,"ngClass"],[1,"modal-footer","inputs"],["type","button","role","button","value",t,1,"peertube-button","grey-button",3,"click","key.enter"],["type","submit","value",o,1,"peertube-button","orange-button",3,"click","disabled"],["role","alert",1,"form-error"]];},template:function(t,o){t&1&&E(0,ei,22,10,"ng-template",null,0,ae);},dependencies:[me,se,le,_e,pe,de,ce,U,w,V],styles:["textarea[_ngcontent-%COMP%]{min-height:300px}"]}));var Pt=nt;var ti=["saveModal"],ni=n=>({show:n});function oi(n,s){if(n&1){let e=y();r(0,"button",21),M("click",function(){T(e);let o=c(2);return f(o.openCreateOrUpdateList());}),S(1,"my-global-icon",22),v(2),p(3,1),I(),a();}}function ii(n,s){if(n&1){let e=y();r(0,"div",16)(1,"div",17),E(2,oi,4,0,"button",18),a(),r(3,"div",19)(4,"my-button",20),M("click",function(){T(e);let o=c();return f(o.reloadData());}),a()()();}if(n&2){let e=c();i(2),l("ngIf",!e.isInSelectionMode());}}function ri(n,s){if(n&1&&(r(0,"tr")(1,"th",23)(2,"span",24),p(3,2),a()(),r(4,"th",25)(5,"span",24),p(6,3),a()(),r(7,"th",26),p(8,4),a(),r(9,"th",26),p(10,5),a(),r(11,"th",27),q(12,6),S(13,"p-sortIcon",28),Q(),a()()),n&2){let e=c();i(11),l("ngbTooltip",e.sortTooltip);}}function ai(n,s){if(n&1&&(r(0,"tr")(1,"td",29),S(2,"my-table-expander-icon",30),a(),r(3,"td",31),S(4,"my-action-dropdown",32),a(),r(5,"td"),g(6),a(),r(7,"td"),p(8,7),a(),r(9,"td"),g(10),K(11,"date"),a()()),n&2){let e=s.$implicit,t=s.expanded,o=c();i(2),l("pRowToggler",e)("expanded",t),i(2),l("ngClass",h(11,ni,t))("actions",o.actions)("entry",e),i(2),b(" ",e.listName," "),i(2),Ce(e.words.length),Te(8),i(2),O(re(11,8,e.updatedAt,"short"));}}function si(n,s){if(n&1&&(r(0,"li"),g(1),a()),n&2){let e=s.$implicit;i(),O(e);}}function li(n,s){if(n&1&&(r(0,"tr")(1,"td",33)(2,"ul"),St(3,si,2,1,"li",null,ut),a()()()),n&2){let e=s.$implicit;i(3),At(e.words);}}function _i(n,s){n&1&&(r(0,"tr")(1,"td",34)(2,"div",35),v(3),p(4,8),I(),a()()());}var ot=class ot extends J{constructor(e,t,o,d,A,m){super();this.router=e;this.route=t;this.auth=o;this.notifier=d;this.confirmService=A;this.watchedWordsListService=m;_(this,"mode");_(this,"saveModal");_(this,"lists");_(this,"totalRecords",0);_(this,"sort",{field:"createdAt",order:-1});_(this,"pagination",{count:this.rowsPerPage,start:0});_(this,"actions",[]);let P=()=>this.mode==="user"||this.authUser.hasRight(be.MANAGE_INSTANCE_WATCHED_WORDS);this.actions=[[{iconName:"edit",label:"\u7F16\u8F91",handler:N=>this.openCreateOrUpdateList(N),isDisplayed:P}],[{iconName:"delete",label:"\u5220\u9664",handler:N=>this.removeList(N),isDisplayed:P}]];}get authUser(){return this.auth.getUser();}get accountNameParam(){if(this.mode!=="admin")return this.authUser.account.name;}ngOnInit(){this.initialize(),this.auth.userInformationLoaded.pipe(Bt()).subscribe(()=>this.reloadData());}getIdentifier(){return"WatchedWordsListAdminOwnerComponent";}openCreateOrUpdateList(e){this.saveModal.show(e);}reloadDataInternal(){this.watchedWordsListService.list({pagination:this.pagination,sort:this.sort,accountName:this.accountNameParam}).subscribe({next:e=>{this.totalRecords=e.total,this.lists=e.data;},error:e=>this.notifier.error(e.message)});}removeList(e){return j(this,null,function*(){let t="Are you sure you want to delete this "+e.listName+" list?";(yield this.confirmService.confirm(t,"Delete list"))!==!1&&this.watchedWordsListService.deleteList({listId:e.id,accountName:this.accountNameParam}).subscribe({next:()=>{this.notifier.success(""+e.listName+" removed"),this.reloadData();},error:d=>this.notifier.error(d.message)});});}};_(ot,"\u0275fac",function(t){return new(t||ot)(u(Ne),u(Oe),u(xe),u(H),u(ye),u(Xe));}),_(ot,"\u0275cmp",x({type:ot,selectors:[["my-watched-words-list-admin-owner"]],viewQuery:function(t,o){if(t&1&&F(ti,7),t&2){let d;W(d=B())&&(o.saveModal=d.first);}},inputs:{mode:"mode"},standalone:!0,features:[L,$],decls:8,vars:15,consts:()=>{let e;e="\u5237\u65B0";let t;t="Create a new list";let o;o="\u66F4\u591A\u4FE1\u606F";let d;d="\u64CD\u4F5C";let A;A="List name";let m;m="Words";let P;P="\u65E5\u671F "+"\uFFFD#13\uFFFD"+""+"\uFFFD/#13\uFFFD"+"";let N;N="See all words";let D;D="\u64CD\u4F5C";let k;k=" "+"\uFFFD0\uFFFD"+" words ";let z;return z="No watched word lists found.",[["saveModal",""],t,o,d,A,m,P,k,z,["dataKey","id",3,"onLazyLoad","value","paginator","totalRecords","rows","first","rowsPerPageOptions","sortField","sortOrder","lazy","lazyLoadOnInit","selectionPageOnly","showCurrentPageReport","currentPageReportTemplate","expandedRowKeys"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","emptymessage"],[3,"listAddedOrUpdated","accountName"],[1,"caption"],[1,"left-buttons"],["type","button","class","peertube-create-button",3,"click",4,"ngIf"],[1,"ms-auto","right-form"],["label",e,"icon","refresh",3,"click"],["type","button",1,"peertube-create-button",3,"click"],["iconName","add","aria-hidden","true"],["scope","col",2,"width","40px"],[1,"visually-hidden"],["scope","col",2,"width","150px"],["scope","col",2,"width","300px"],["scope","col","container","body","pSortableColumn","updatedAt",2,"width","150px",3,"ngbTooltip"],["field","updatedAt"],[1,"expand-cell"],["tooltip",N,3,"pRowToggler","expanded"],[1,"action-cell"],["placement","bottom-right","container","body","label",D,3,"ngClass","actions","entry"],["myAutoColspan","",1,"expand-cell"],["myAutoColspan",""],[1,"no-results"]];},template:function(t,o){if(t&1){let d=y();r(0,"p-table",9),M("onLazyLoad",function(m){return T(d),f(o.loadLazy(m));}),E(1,ii,5,1,"ng-template",10)(2,ri,14,1,"ng-template",11)(3,ai,12,13,"ng-template",12)(4,li,5,0,"ng-template",13)(5,_i,5,0,"ng-template",14),a(),r(6,"my-watched-words-list-save-modal",15,0),M("listAddedOrUpdated",function(){return T(d),f(o.reloadData());}),a();}t&2&&(l("value",o.lists)("paginator",o.totalRecords>0)("totalRecords",o.totalRecords)("rows",o.rowsPerPage)("first",o.pagination.start)("rowsPerPageOptions",o.rowsPerPageOptions)("sortField",o.sort.field)("sortOrder",o.sort.order)("lazy",!0)("lazyLoadOnInit",!1)("selectionPageOnly",!1)("showCurrentPageReport",!0)("currentPageReportTemplate",o.getPaginationTemplate())("expandedRowKeys",o.expandedRows),i(6),l("accountName",o.accountNameParam));},dependencies:[U,Ge,Ve,ve,Ue,ze,ke,Ie,w,we,Nt,Be,V,We,Y,De,Pt],encapsulation:2}));var In=ot;var di=n=>({show:n}),ci=()=>["."],mi=n=>({search:n});function pi(n,s){if(n&1&&S(0,"my-action-dropdown",22),n&2){let e=c(2);l("actions",e.bulkActions)("entry",e.selectedRows);}}function ui(n,s){if(n&1){let e=y();r(0,"div",17)(1,"div"),E(2,pi,1,2,"my-action-dropdown",18),a(),r(3,"div",19)(4,"my-advanced-input-filter",20),M("search",function(o){T(e);let d=c();return f(d.onSearch(o));}),a(),r(5,"my-button",21),M("click",function(){T(e);let o=c();return f(o.reloadData());}),a()()();}if(n&2){let e=c();i(2),l("ngIf",e.isInSelectionMode()),i(2),l("filters",e.inputFilters);}}function Si(n,s){if(n&1&&(r(0,"tr")(1,"th",23),S(2,"p-tableHeaderCheckbox",24),a(),r(3,"th",23)(4,"span",25),p(5,0),a()(),r(6,"th",26)(7,"span",25),p(8,1),a()(),r(9,"th",27),p(10,2),a(),r(11,"th",27),p(12,3),a(),r(13,"th",27),p(14,4),a(),r(15,"th",27),p(16,5),a(),r(17,"th",28),q(18,6),S(19,"p-sortIcon",29),Q(),a()()),n&2){let e=c();i(17),l("ngbTooltip",e.sortTooltip);}}function Ai(n,s){n&1&&(r(0,"span",48),p(1,8),a());}function Ei(n,s){if(n&1&&(r(0,"a",46),g(1),a()),n&2){let e=s.$implicit,t=c(2);l("routerLink",ee(3,ci))("queryParams",h(4,mi,t.buildSearchAutoTag(e))),i(),O(e);}}function gi(n,s){if(n&1&&(r(0,"tr",30)(1,"td",31),S(2,"p-tableCheckbox",32),a(),r(3,"td",33),S(4,"my-table-expander-icon",34),a(),r(5,"td",35),S(6,"my-action-dropdown",36),a(),r(7,"td")(8,"a",37)(9,"div",38),S(10,"my-actor-avatar",39),r(11,"div"),g(12),r(13,"span"),g(14),a()()()()(),r(15,"td",40)(16,"em"),p(17,7),a(),r(18,"a",41),g(19),a()(),r(20,"td",42),E(21,Ai,2,0,"span",43),r(22,"div",44),S(23,"div",45),a()(),r(24,"td"),St(25,Ei,2,6,"a",46,ut),a(),r(27,"td",47),g(28),K(29,"date"),a()()),n&2){let e=s.$implicit,t=s.expanded,o=c();l("pSelectableRow",e),i(2),l("value",e),i(2),l("pRowToggler",e)("expanded",t),i(2),l("ngClass",h(21,di,t))("actions",o.videoCommentActions)("entry",e),i(2),l("href",e.account.localUrl,ge),i(2),l("actor",e.account),i(2),b(" ",e.account.displayName," "),i(2),O(e.by),i(4),l("href",e.localUrl,ge),i(),O(e.video.name),i(),l("pRowToggler",e),i(),l("ngIf",e.heldForReview),i(2),l("innerHTML",e.textHtml,G),i(2),At(e.automaticTags),i(2),l("pRowToggler",e),i(),O(re(29,18,e.createdAt,"short"));}}function Ci(n,s){if(n&1&&(r(0,"tr")(1,"td",49),S(2,"div",45),a()()),n&2){let e=s.$implicit;i(2),l("innerHTML",e.textHtml,G);}}function Ti(n,s){n&1&&(v(0),p(1,9),I());}function fi(n,s){n&1&&(v(0),p(1,10),I());}function Mi(n,s){if(n&1&&(r(0,"tr")(1,"td",50)(2,"div",51),E(3,Ti,2,0,"ng-container",52)(4,fi,2,0,"ng-container",52),a()()()),n&2){let e=c();i(3),l("ngIf",e.search),i(),l("ngIf",!e.search);}}var it=class it extends J{constructor(e,t,o,d,A,m,P,N){super();this.router=e;this.route=t;this.auth=o;this.notifier=d;this.confirmService=A;this.videoCommentService=m;this.markdownRenderer=P;this.bulkService=N;_(this,"mode");_(this,"comments");_(this,"totalRecords",0);_(this,"sort",{field:"createdAt",order:-1});_(this,"pagination",{count:this.rowsPerPage,start:0});_(this,"videoCommentActions",[]);_(this,"bulkActions",[]);_(this,"inputFilters",[]);this.videoCommentActions=[[{label:"\u5220\u9664\u6B64\u8BC4\u8BBA",handler:D=>this.removeComment(D),isDisplayed:()=>this.mode==="user"||this.authUser.hasRight(be.MANAGE_ANY_VIDEO_COMMENT)},{label:"\u5220\u9664\u6B64\u5E10\u6237\u7684\u6240\u6709\u8BC4\u8BBA",description:"\u8BC4\u8BBA\u5C06\u5728\u51E0\u5206\u949F\u540E\u5220\u9664",handler:D=>this.removeCommentsOfAccount(D),isDisplayed:()=>this.mode==="admin"&&this.authUser.hasRight(be.MANAGE_ANY_VIDEO_COMMENT)}],[{label:"Approve this comment",handler:D=>this.approveComments([D]),isDisplayed:D=>this.mode==="user"&&D.heldForReview}]];}get authUser(){return this.auth.getUser();}ngOnInit(){this.initialize(),this.bulkActions=[{label:"\u5220\u9664",handler:e=>this.removeComments(e),isDisplayed:()=>this.mode==="user"||this.authUser.hasRight(be.MANAGE_ANY_VIDEO_COMMENT),iconName:"delete"},{label:"Approve",handler:e=>this.approveComments(e),isDisplayed:e=>this.mode==="user"&&e.every(t=>t.heldForReview),iconName:"tick"}],this.mode==="admin"?this.inputFilters=[{title:"\u9AD8\u7EA7\u8FC7\u6EE4",children:[{value:"local:true",label:"\u672C\u5730\u8BC4\u8BBA"},{value:"local:false",label:"\u8FDC\u7AEF\u8BC4\u8BBA"},{value:"localVideo:true",label:"\u672C\u5730\u89C6\u9891\u7684\u8BC4\u8BBA"}]}]:this.inputFilters=[{title:"\u9AD8\u7EA7\u8FC7\u6EE4",children:[{value:"heldForReview:true",label:"Display comments awaiting your approval"}]}];}getIdentifier(){return"VideoCommentListAdminOwnerComponent";}toHtml(e){return this.markdownRenderer.textMarkdownToHTML({markdown:e,withHtml:!0,withEmoji:!0});}buildSearchAutoTag(e){let t=`autoTag:"${e}"`;return this.search?this.search+" "+t:t;}reloadDataInternal(){(this.mode==="admin"?this.videoCommentService.listAdminVideoComments.bind(this.videoCommentService):this.videoCommentService.listVideoCommentsOfMyVideos.bind(this.videoCommentService))({pagination:this.pagination,sort:this.sort,search:this.search}).subscribe({next:t=>j(this,null,function*(){this.totalRecords=t.total,this.comments=[];for(let o of t.data)this.comments.push(new cn(o,yield this.toHtml(o.text)));}),error:t=>this.notifier.error(t.message)});}approveComments(e){let t=e.map(o=>({videoId:o.video.id,commentId:o.id}));this.videoCommentService.approveComments(t).subscribe({next:()=>{this.notifier.success(Pe("{count, plural, =1 {Comment approved.} other {{count} comments approved.}}",{count:t.length})),this.reloadData();},error:o=>this.notifier.error(o.message),complete:()=>this.selectedRows=[]});}removeComments(e){let t=e.map(o=>({videoId:o.video.id,commentId:o.id}));this.videoCommentService.deleteVideoComments(t).subscribe({next:()=>{this.notifier.success(Pe("{count, plural, =1 {1 \u6761\u8BC4\u8BBA\u5DF2\u88AB\u5220\u9664\u3002} other {{count} \u6761\u8BC4\u8BBA\u5DF2\u88AB\u5220\u9664\u3002}}",{count:t.length})),this.reloadData();},error:o=>this.notifier.error(o.message),complete:()=>this.selectedRows=[]});}removeComment(e){this.videoCommentService.deleteVideoComment(e.video.id,e.id).subscribe({next:()=>this.reloadData(),error:t=>this.notifier.error(t.message)});}removeCommentsOfAccount(e){return j(this,null,function*(){let t="\u4F60\u786E\u5B9A\u8981\u5220\u9664 "+e.by+" \u7684\u6240\u6709\u8BC4\u8BBA\u5417\uFF1F";if((yield this.confirmService.confirm(t,"\u5220\u9664"))===!1)return;let d={accountName:e.by,scope:"instance"};this.bulkService.removeCommentsOf(d).subscribe({next:()=>{this.notifier.success("\u8BC4\u8BBA "+d.accountName+" \u5C06\u5728\u51E0\u5206\u949F\u5185\u5220\u9664");},error:A=>this.notifier.error(A.message)});});}};_(it,"\u0275fac",function(t){return new(t||it)(u(Ne),u(Oe),u(xe),u(H),u(ye),u(bt),u(Rt),u(un));}),_(it,"\u0275cmp",x({type:it,selectors:[["my-video-comment-list-admin-owner"]],inputs:{mode:"mode"},standalone:!0,features:[L,$],decls:6,vars:15,consts:()=>{let e;e="\u6279\u91CF\u64CD\u4F5C";let t;t="\u5237\u65B0";let o;o="\u9009\u62E9\u6240\u6709\u884C";let d;d="\u66F4\u591A\u4FE1\u606F";let A;A="\u64CD\u4F5C";let m;m="\u5E10\u6237";let P;P="\u89C6\u9891";let N;N="\u8BC4\u8BBA";let D;D="Auto tags";let k;k="\u65E5\u671F "+"\uFFFD#19\uFFFD"+""+"\uFFFD/#19\uFFFD"+"";let z;z="\u9009\u62E9\u6B64\u884C";let R;R="\u67E5\u770B\u5B8C\u6574\u8BC4\u8BBA";let Re;Re="\u64CD\u4F5C";let rt;rt="\u5728\u65B0\u6807\u7B7E\u9875\u4E2D\u6253\u5F00\u5E10\u6237";let at;at="Only display comments with this tag";let st;st="\u5DF2\u8BC4\u8BBA\u89C6\u9891";let lt;lt="Pending review";let _t;_t="\u6CA1\u6709\u627E\u5230\u4E0E\u5F53\u524D\u8FC7\u6EE4\u5668\u5339\u914D\u7684\u8BC4\u8BBA\u3002";let dt;return dt="\u6CA1\u6709\u627E\u5230\u8BC4\u8BBA\u3002",[d,A,m,P,N,D,k,st,lt,_t,dt,["dataKey","id",3,"onLazyLoad","selectionChange","value","paginator","totalRecords","rows","first","rowsPerPageOptions","sortField","sortOrder","lazy","lazyLoadOnInit","selectionPageOnly","showCurrentPageReport","currentPageReportTemplate","expandedRowKeys","selection"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","emptymessage"],[1,"caption"],["label",e,"theme","orange",3,"actions","entry",4,"ngIf"],[1,"ms-auto","right-form"],[3,"search","filters"],["label",t,"icon","refresh",3,"click"],["label",e,"theme","orange",3,"actions","entry"],["scope","col",2,"width","40px"],["ariaLabel",o],[1,"visually-hidden"],["scope","col",2,"width","150px"],["scope","col"],["scope","col","container","body","pSortableColumn","createdAt",2,"width","150px",3,"ngbTooltip"],["field","createdAt"],[3,"pSelectableRow"],[1,"checkbox-cell"],["ariaLabel",z,3,"value"],[1,"expand-cell"],["tooltip",R,3,"pRowToggler","expanded"],[1,"action-cell"],["placement","bottom-right","container","body","label",Re,3,"ngClass","actions","entry"],["title",rt,"target","_blank","rel","noopener noreferrer",3,"href"],[1,"chip","two-lines"],["actorType","account","size","32",3,"actor"],[1,"video"],["target","_blank","rel","noopener noreferrer",3,"href"],[1,"c-hand","comment-content-cell",3,"pRowToggler"],["class","pt-badge badge-red float-start me-2",4,"ngIf"],[1,"comment-html"],[3,"innerHTML"],["title",at,1,"pt-badge","badge-secondary","me-1",3,"routerLink","queryParams"],[1,"c-hand",3,"pRowToggler"],[1,"pt-badge","badge-red","float-start","me-2"],["myAutoColspan","",1,"expand-cell"],["myAutoColspan",""],[1,"no-results"],[4,"ngIf"]];},template:function(t,o){t&1&&(r(0,"p-table",11),M("onLazyLoad",function(A){return o.loadLazy(A);}),Xt("selectionChange",function(A){return Gt(o.selectedRows,A)||(o.selectedRows=A),A;}),E(1,ui,6,2,"ng-template",12)(2,Si,20,1,"ng-template",13)(3,gi,30,23,"ng-template",14)(4,Ci,3,1,"ng-template",15)(5,Mi,5,2,"ng-template",16),a()),t&2&&(l("value",o.comments)("paginator",o.totalRecords>0)("totalRecords",o.totalRecords)("rows",o.rowsPerPage)("first",o.pagination.start)("rowsPerPageOptions",o.rowsPerPageOptions)("sortField",o.sort.field)("sortOrder",o.sort.order)("lazy",!0)("lazyLoadOnInit",!1)("selectionPageOnly",!0)("showCurrentPageReport",!0)("currentPageReportTemplate",o.getPaginationTemplate())("expandedRowKeys",o.expandedRows),zt("selection",o.selectedRows));},dependencies:[Ge,Ve,ve,Ue,sn,ze,ke,_n,dn,Ie,w,we,ht,Nt,De,Be,V,$e,We,Y,Ct],styles:[".moderation-expanded[_ngcontent-%COMP%]{font-size:90%;display:flex;flex-wrap:wrap;justify-content:space-between}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-label[_ngcontent-%COMP%]{font-weight:600;display:inline-block;vertical-align:top;text-align:end;min-width:100px;margin-inline-end:.3125rem}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-text[_ngcontent-%COMP%]{display:inline-flex;word-wrap:break-word}.moderation-expanded[_ngcontent-%COMP%]   .moderation-expanded-text[_ngcontent-%COMP%]     p:last-child{margin-bottom:0!important}.moderation-expanded[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:50%;max-width:500px}@media screen and (max-width: 960px){.moderation-expanded[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:100%}}my-action-dropdown.show[_ngcontent-%COMP%]     .dropdown-root{display:block!important}.table-comment-link[_ngcontent-%COMP%], .table-account-link[_ngcontent-%COMP%]{color:var(--mainForegroundColor)}.table-comment-link[_ngcontent-%COMP%]:focus:not(:focus-visible), .table-account-link[_ngcontent-%COMP%]:focus:not(:focus-visible){outline:none!important}.table-comment-link[_ngcontent-%COMP%]     p:last-child, .table-account-link[_ngcontent-%COMP%]     p:last-child{margin:0}.table-account-link[_ngcontent-%COMP%]{display:flex;flex-direction:column}my-abuse-details[_ngcontent-%COMP%]{width:100%}@media screen and (max-width: 960px){.abuse-messages[_ngcontent-%COMP%]{justify-content:flex-start!important}}","my-global-icon[_ngcontent-%COMP%]{width:24px;height:24px}.video[_ngcontent-%COMP%]{display:flex;flex-direction:column}.video[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-size:11px}.video[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--mainForegroundColor);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.comment-content-cell[_ngcontent-%COMP%] > .pt-badge[_ngcontent-%COMP%]{position:relative;top:2px}.comment-html[_ngcontent-%COMP%]    >div{max-height:22px}.comment-html[_ngcontent-%COMP%]     div, .comment-html[_ngcontent-%COMP%]     p{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.comment-html[_ngcontent-%COMP%]     p{margin:0}.right-form[_ngcontent-%COMP%]{display:flex}.right-form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(:last-child){margin-inline-end:.625rem}@media screen and (max-width: 960px){.video[_ngcontent-%COMP%]{align-items:flex-start!important}}"]}));var Pn=it;export{gn as a,On as b,Nn as c,hn as d,Xe as e,In as f,Pn as g,An as h};/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/