import{b as V,c as H}from"./chunk-GP5LX4CA.js";import{$ as p,B as n,C as E,Gc as v,Kc as m,T as h,Ue as g,Y as d,gg as u,j as f,kg as x,m as R,p as l}from"./chunk-4A7FW7VV.js";import{j as a}from"./chunk-K6ICEIKK.js";var c=class c{constructor(t,e){this.authHttp=t;this.restExtractor=e;a(this,"store",new Map)}getVideoFileToken({videoUUID:t,videoPassword:e}){let r=this.store.get(t);return r?f(r):this.createVideoFileToken(t,e).pipe(h(o=>this.store.set(t,{token:o.token,expires:new Date(o.expires)})))}createVideoFileToken(t,e){let r=V.buildVideoPasswordHeader(e);return this.authHttp.post(`${H.BASE_VIDEO_URL}/${t}/token`,{},{headers:r}).pipe(R(({files:o})=>o),n(o=>this.restExtractor.handleError(o)))}};a(c,"\u0275fac",function(e){return new(e||c)(p(m),p(u))}),a(c,"\u0275prov",d({token:c,factory:c.\u0275fac}));var b=c;var i=class i{constructor(t,e,r){this.authHttp=t;this.restService=e;this.restExtractor=r}updateRedundancy(t,e){let r=i.BASE_REDUNDANCY_URL+"/"+t,o={redundancyAllowed:e};return this.authHttp.put(r,o).pipe(n(s=>this.restExtractor.handleError(s)))}listVideoRedundancies(t){let{pagination:e,sort:r,target:o}=t,s=new v;return s=this.restService.addRestGetParams(s,e,r),o&&(s=s.append("target",o)),this.authHttp.get(i.BASE_REDUNDANCY_URL+"/videos",{params:s}).pipe(n(A=>this.restExtractor.handleError(A)))}addVideoRedundancy(t){return this.authHttp.post(i.BASE_REDUNDANCY_URL+"/videos",{videoId:t.id}).pipe(n(e=>this.restExtractor.handleError(e)))}removeVideoRedundancies(t){let e=t.redundancies.streamingPlaylists.map(r=>r.id).concat(t.redundancies.files.map(r=>r.id)).map(r=>this.removeRedundancy(r));return l(...e).pipe(E())}removeRedundancy(t){return this.authHttp.delete(i.BASE_REDUNDANCY_URL+"/videos/"+t).pipe(n(e=>this.restExtractor.handleError(e)))}};a(i,"BASE_REDUNDANCY_URL",g.apiUrl+"/api/v1/server/redundancy"),a(i,"\u0275fac",function(e){return new(e||i)(p(m),p(x),p(u))}),a(i,"\u0275prov",d({token:i,factory:i.\u0275fac}));var y=i;export{b as a,y as b};
/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/
