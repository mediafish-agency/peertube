import{b as v}from"./chunk-GP5LX4CA.js";import{a as L}from"./chunk-4XL6BJ7M.js";import{$ as C,Af as f,B as m,C as E,D as A,Gc as g,Kc as T,Ue as R,Y as I,gg as U,i as S,kg as w,m as h,md as l,of as b,wf as x}from"./chunk-4A7FW7VV.js";import{j as o}from"./chunk-K6ICEIKK.js";var c=class{constructor(e){o(this,"id");o(this,"url");o(this,"text");o(this,"threadId");o(this,"inReplyToCommentId");o(this,"videoId");o(this,"createdAt");o(this,"updatedAt");o(this,"deletedAt");o(this,"isDeleted");o(this,"heldForReview");o(this,"account");o(this,"totalRepliesFromVideoAuthor");o(this,"totalReplies");o(this,"by");o(this,"isLocal");if(this.id=e.id,this.url=e.url,this.text=e.text,this.threadId=e.threadId,this.inReplyToCommentId=e.inReplyToCommentId,this.videoId=e.videoId,this.createdAt=new Date(e.createdAt.toString()),this.updatedAt=new Date(e.updatedAt.toString()),this.deletedAt=e.deletedAt?new Date(e.deletedAt.toString()):null,this.isDeleted=e.isDeleted,this.heldForReview=e.heldForReview,this.account=e.account,this.totalRepliesFromVideoAuthor=e.totalRepliesFromVideoAuthor,this.totalReplies=e.totalReplies,this.account){this.by=f.CREATE_BY_STRING(this.account.name,this.account.host);let t=x(),r=new URL(t).host;this.isLocal=this.account.host.trim()===r}}},F=class{constructor(e,t){o(this,"id");o(this,"url");o(this,"text");o(this,"textHtml");o(this,"threadId");o(this,"inReplyToCommentId");o(this,"createdAt");o(this,"updatedAt");o(this,"account");o(this,"localUrl");o(this,"video");o(this,"heldForReview");o(this,"automaticTags");o(this,"by");this.id=e.id,this.url=e.url,this.text=e.text,this.textHtml=t,this.heldForReview=e.heldForReview,this.threadId=e.threadId,this.inReplyToCommentId=e.inReplyToCommentId,this.createdAt=new Date(e.createdAt.toString()),this.updatedAt=new Date(e.updatedAt.toString()),this.automaticTags=e.automaticTags,this.video={id:e.video.id,uuid:e.video.uuid,name:e.video.name,localUrl:L.buildWatchUrl(e.video)},this.localUrl=this.video.localUrl+";threadId="+this.threadId,this.account=e.account,this.account&&(this.by=f.CREATE_BY_STRING(this.account.name,this.account.host),this.account.localUrl="/a/"+this.by)}};var n=class n{constructor(e,t,r){this.authHttp=e;this.restExtractor=t;this.restService=r}addCommentThread(e,t,r){let i=v.buildVideoPasswordHeader(r),d=n.BASE_VIDEO_URL+e+"/comment-threads",s=b(t,"text");return this.authHttp.post(d,s,{headers:i}).pipe(h(a=>this.extractVideoComment(a.comment)),m(a=>this.restExtractor.handleError(a)))}addCommentReply(e){let{videoId:t,inReplyToCommentId:r,comment:i,videoPassword:d}=e,s=v.buildVideoPasswordHeader(d),a=n.BASE_VIDEO_URL+t+"/comments/"+r,u=b(i,"text");return this.authHttp.post(a,u,{headers:s}).pipe(h(p=>this.extractVideoComment(p.comment)),m(p=>this.restExtractor.handleError(p)))}approveComments(e){return S(e).pipe(A(({videoId:t,commentId:r})=>{let i=n.BASE_VIDEO_URL+t+"/comments/"+r+"/approve";return this.authHttp.post(i,{}).pipe(m(d=>this.restExtractor.handleError(d)))}),E())}listVideoCommentsOfMyVideos(e){let{pagination:t,sort:r,search:i}=e,d=n.BASE_ME_URL+"videos/comments",s=new g;return s=this.restService.addRestGetParams(s,t,r),i&&(s=this.buildParamsFromSearch(i,s)),this.authHttp.get(d,{params:s}).pipe(m(a=>this.restExtractor.handleError(a)))}listAdminVideoComments(e){let{pagination:t,sort:r,search:i}=e,d=n.BASE_VIDEO_URL+"comments",s=new g;return s=this.restService.addRestGetParams(s,t,r),i&&(s=this.buildParamsFromSearch(i,s)),this.authHttp.get(d,{params:s}).pipe(m(a=>this.restExtractor.handleError(a)))}getVideoCommentThreads(e){let{videoId:t,videoPassword:r,componentPagination:i,sort:d}=e,s=v.buildVideoPasswordHeader(r),a=this.restService.componentToRestPagination(i),u=new g;u=this.restService.addRestGetParams(u,a,d);let p=n.BASE_VIDEO_URL+t+"/comment-threads";return this.authHttp.get(p,{params:u,headers:s}).pipe(h(V=>this.extractVideoComments(V)),m(V=>this.restExtractor.handleError(V)))}getVideoThreadComments(e){let{videoId:t,threadId:r,videoPassword:i}=e,d=`${n.BASE_VIDEO_URL+t}/comment-threads/${r}`,s=v.buildVideoPasswordHeader(i);return this.authHttp.get(d,{headers:s}).pipe(h(a=>this.extractVideoCommentTree(a)),m(a=>this.restExtractor.handleError(a)))}deleteVideoComment(e,t){let r=`${n.BASE_VIDEO_URL+e}/comments/${t}`;return this.authHttp.delete(r).pipe(m(i=>this.restExtractor.handleError(i)))}deleteVideoComments(e){return S(e).pipe(A(t=>this.deleteVideoComment(t.videoId,t.commentId)),E())}getVideoCommentsFeeds(e){let t=[{format:l.RSS,label:"rss 2.0",url:n.BASE_FEEDS_URL+l.RSS.toLowerCase()},{format:l.ATOM,label:"atom 1.0",url:n.BASE_FEEDS_URL+l.ATOM.toLowerCase()},{format:l.JSON,label:"json 1.0",url:n.BASE_FEEDS_URL+l.JSON.toLowerCase()}];if(e!==void 0)for(let r of t)r.url+="?videoId="+e.uuid;return t}extractVideoComment(e){return new c(e)}extractVideoComments(e){let t=e.data,r=e.total,i=[];for(let d of t)i.push(new c(d));return{data:i,total:r,totalNotDeletedComments:e.totalNotDeletedComments}}extractVideoCommentTree(e){if(!e)return null;let t={comment:new c(e.comment),children:e.children.map(i=>this.extractVideoCommentTree(i))},r=t.children.length===0?!t.comment.isDeleted:t.children.some(i=>i.hasDisplayedChildren);return Object.assign(t,{hasDisplayedChildren:r})}buildParamsFromSearch(e,t){let r=this.restService.parseQueryStringFilter(e,{isLocal:{prefix:"local:",isBoolean:!0},onLocalVideo:{prefix:"localVideo:",isBoolean:!0},isHeldForReview:{prefix:"heldForReview:",isBoolean:!0},autoTagOneOf:{prefix:"autoTag:",multiple:!0},searchAccount:{prefix:"account:"},searchVideo:{prefix:"video:"}});return this.restService.addObjectParams(t,r)}};o(n,"BASE_FEEDS_URL",R.apiUrl+"/feeds/video-comments."),o(n,"BASE_VIDEO_URL",R.apiUrl+"/api/v1/videos/"),o(n,"BASE_ME_URL",R.apiUrl+"/api/v1/users/me/"),o(n,"\u0275fac",function(t){return new(t||n)(C(T),C(U),C(w))}),o(n,"\u0275prov",I({token:n,factory:n.\u0275fac}));var P=n;export{c as a,F as b,P as c};
/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/
