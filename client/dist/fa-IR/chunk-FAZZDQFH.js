import{a as m}from"./chunk-6C7DPHTS.js";import{a as k}from"./chunk-4XL6BJ7M.js";import{a as h}from"./chunk-DPQ4XGHN.js";import{$ as a,Af as N,B as c,Bf as T,Gc as A,Ic as u,Kc as E,T as b,Te as _,Ue as I,Y as g,gg as S,hg as R,kg as O,m as v,og as V,wd as e,xd as f}from"./chunk-4A7FW7VV.js";import{j as i}from"./chunk-K6ICEIKK.js";var p=class{constructor(t,r){i(this,"id");i(this,"type");i(this,"read");i(this,"video");i(this,"videoImport");i(this,"comment");i(this,"abuse");i(this,"videoBlacklist");i(this,"account");i(this,"actorFollow");i(this,"plugin");i(this,"peertube");i(this,"registration");i(this,"videoCaption");i(this,"createdAt");i(this,"updatedAt");i(this,"videoUrl");i(this,"commentUrl");i(this,"commentReviewUrl");i(this,"commentReviewQueryParams",{});i(this,"abuseUrl");i(this,"abuseQueryParams",{});i(this,"videoAutoBlacklistUrl");i(this,"accountUrl");i(this,"registrationsUrl");i(this,"videoImportIdentifier");i(this,"videoImportUrl");i(this,"instanceFollowUrl");i(this,"peertubeVersionLink");i(this,"pluginUrl");i(this,"pluginQueryParams",{});this.id=t.id,this.type=t.type,this.read=t.read;try{switch(this.video=t.video,this.video&&this.setVideoChannelAvatarUrl(this.video.channel),this.videoImport=t.videoImport,this.comment=t.comment,this.comment&&this.setAccountAvatarUrl(this.comment.account),this.abuse=t.abuse,this.videoBlacklist=t.videoBlacklist,this.account=t.account,this.account&&this.setAccountAvatarUrl(this.account),this.actorFollow=t.actorFollow,this.actorFollow&&this.setAccountAvatarUrl(this.actorFollow.follower),this.plugin=t.plugin,this.peertube=t.peertube,this.registration=t.registration,this.videoCaption=t.videoCaption,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt,this.type){case e.NEW_VIDEO_FROM_SUBSCRIPTION:case e.NEW_LIVE_FROM_SUBSCRIPTION:this.videoUrl=this.buildVideoUrl(this.video);break;case e.UNBLACKLIST_ON_MY_VIDEO:this.videoUrl=this.buildVideoUrl(this.video);break;case e.NEW_COMMENT_ON_MY_VIDEO:case e.COMMENT_MENTION:if(!this.comment)break;this.accountUrl=this.buildAccountUrl(this.comment.account),this.commentUrl=this.buildCommentUrl(this.comment),this.commentReviewUrl="/my-account/videos/comments",this.commentReviewQueryParams.search="heldForReview:true";break;case e.NEW_ABUSE_FOR_MODERATORS:this.abuseUrl="/admin/moderation/abuses/list",this.abuseQueryParams.search="#"+this.abuse.id,this.abuse.video?this.videoUrl=this.buildVideoUrl(this.abuse.video):this.abuse.comment?this.commentUrl=this.buildCommentUrl(this.abuse.comment):this.abuse.account&&(this.accountUrl=this.buildAccountUrl(this.abuse.account));break;case e.ABUSE_STATE_CHANGE:this.abuseUrl="/my-account/abuses",this.abuseQueryParams.search="#"+this.abuse.id;break;case e.ABUSE_NEW_MESSAGE:this.abuseUrl=r.hasRight(f.MANAGE_ABUSES)?"/admin/moderation/abuses/list":"/my-account/abuses",this.abuseQueryParams.search="#"+this.abuse.id;break;case e.VIDEO_AUTO_BLACKLIST_FOR_MODERATORS:this.videoAutoBlacklistUrl="/admin/moderation/video-auto-blacklist/list",this.videoBlacklist||(this.videoBlacklist={id:null,video:this.video}),this.videoUrl=this.buildVideoUrl(this.videoBlacklist.video);break;case e.BLACKLIST_ON_MY_VIDEO:this.videoUrl=this.buildVideoUrl(this.videoBlacklist.video);break;case e.MY_VIDEO_PUBLISHED:this.videoUrl=this.buildVideoUrl(this.video);break;case e.MY_VIDEO_IMPORT_SUCCESS:this.videoImportUrl=this.buildVideoImportUrl(),this.videoImportIdentifier=this.buildVideoImportIdentifier(this.videoImport),this.videoImport.video&&(this.videoUrl=this.buildVideoUrl(this.videoImport.video));break;case e.MY_VIDEO_IMPORT_ERROR:this.videoImportUrl=this.buildVideoImportUrl(),this.videoImportIdentifier=this.buildVideoImportIdentifier(this.videoImport);break;case e.NEW_USER_REGISTRATION:this.accountUrl=this.buildAccountUrl(this.account);break;case e.NEW_USER_REGISTRATION_REQUEST:this.registrationsUrl="/admin/moderation/registrations/list";break;case e.NEW_FOLLOW:this.accountUrl=this.buildAccountUrl(this.actorFollow.follower);break;case e.NEW_INSTANCE_FOLLOWER:this.instanceFollowUrl="/admin/follows/followers-list";break;case e.AUTO_INSTANCE_FOLLOWING:this.instanceFollowUrl="/admin/follows/following-list";break;case e.NEW_PEERTUBE_VERSION:this.peertubeVersionLink="https://joinpeertube.org/news";break;case e.NEW_PLUGIN_VERSION:this.pluginUrl="/admin/plugins/list-installed",this.pluginQueryParams.pluginType=this.plugin.type+"";break;case e.MY_VIDEO_TRANSCRIPTION_GENERATED:this.videoUrl=this.buildVideoUrl(this.videoCaption.video);break;case e.MY_VIDEO_STUDIO_EDITION_FINISHED:this.videoUrl=this.buildVideoUrl(this.video);break}}catch(s){this.type=null,_.error(s)}}buildVideoUrl(t){return k.buildWatchUrl(t)}buildAccountUrl(t){return"/a/"+N.CREATE_BY_STRING(t.name,t.host)}buildVideoImportUrl(){return"/my-library/video-imports"}buildVideoImportIdentifier(t){var r;return((r=t.video)==null?void 0:r.name)||t.targetUrl||t.magnetUri||t.torrentName}buildCommentUrl(t){return[this.buildVideoUrl(t.video),{threadId:t.threadId}]}setAccountAvatarUrl(t){t.avatarUrl=h.GET_ACTOR_AVATAR_URL(t,48)||T.GET_DEFAULT_AVATAR_URL(48)}setVideoChannelAvatarUrl(t){t.avatarUrl=h.GET_ACTOR_AVATAR_URL(t,48)||h.GET_DEFAULT_AVATAR_URL(48)}};var o=class o{constructor(t,r,s,n,d){this.authHttp=t;this.auth=r;this.restExtractor=s;this.restService=n;this.peertubeSocket=d}listMyNotifications(t){let{pagination:r,ignoreLoadingBar:s,unread:n,sort:d}=t,l=new A;l=this.restService.addRestGetParams(l,this.restService.componentToRestPagination(r),d),n&&(l=l.append("unread",`${n}`));let C=s?new u().set(m,!0):void 0;return this.authHttp.get(o.BASE_NOTIFICATIONS_URL,{params:l,context:C}).pipe(v(U=>this.restExtractor.applyToResultListData(U,this.formatNotification.bind(this))),c(U=>this.restExtractor.handleError(U)))}countUnreadNotifications(){return this.listMyNotifications({pagination:{currentPage:1,itemsPerPage:0},ignoreLoadingBar:!0,unread:!0}).pipe(v(t=>t.total))}markAsRead(t){let r=o.BASE_NOTIFICATIONS_URL+"/read",s={ids:[t.id]},n=new u().set(m,!0);return this.authHttp.post(r,s,{context:n}).pipe(b(()=>this.peertubeSocket.dispatchNotificationEvent("read")),c(d=>this.restExtractor.handleError(d)))}markAllAsRead(){let t=o.BASE_NOTIFICATIONS_URL+"/read-all",r=new u().set(m,!0);return this.authHttp.post(t,{},{context:r}).pipe(b(()=>this.peertubeSocket.dispatchNotificationEvent("read-all")),c(s=>this.restExtractor.handleError(s)))}updateNotificationSettings(t){let r=o.BASE_NOTIFICATION_SETTINGS;return this.authHttp.put(r,t).pipe(c(s=>this.restExtractor.handleError(s)))}formatNotification(t){return new p(t,this.auth.getUser())}};i(o,"BASE_NOTIFICATIONS_URL",I.apiUrl+"/api/v1/users/me/notifications"),i(o,"BASE_NOTIFICATION_SETTINGS",I.apiUrl+"/api/v1/users/me/notification-settings"),i(o,"\u0275fac",function(r){return new(r||o)(a(E),a(R),a(S),a(O),a(V))}),i(o,"\u0275prov",g({token:o,factory:o.\u0275fac}));var y=o;export{y as a};
/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/
