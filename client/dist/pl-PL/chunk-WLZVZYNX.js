import{Ab as re,Bb as $,Ca as u,Cc as ue,E as ne,Ib as ie,Jb as ae,Kb as ce,Oa as w,Ra as z,Sa as S,Va as F,Y as k,_ as R,aa as y,ab as f,ba as se,bb as d,c as ee,gb as H,kb as j,la as D,m as te,ma as T,ob as v,pb as C,rc as le,s as L,sa as x,ta as oe,zb as N}from"./chunk-4A7FW7VV.js";import{a as g,b as W,j as p,k as h}from"./chunk-K6ICEIKK.js";function ye(){return new XMLHttpRequest();}function de(n){n=null;}var X=class{constructor(e){this.buildXhr=e,this.request=({method:t="GET",data:s=null,headers:o={},url:r,responseType:c,signal:a,onUploadProgress:A,timeout:O=0,withCredentials:M=!1,validateStatus:Se=E=>E<400&&E>=200})=>new Promise((E,Y)=>{let i=this.buildXhr(),U=()=>i&&i.readyState!==i.DONE&&i.abort();a==null||a.addEventListener("abort",U,{once:!0}),i.open(t,r,!0),i.timeout=O,M&&(i.withCredentials=!0),c&&c!=="json"&&(i.responseType=c),Object.keys(o).forEach(m=>i.setRequestHeader(m,String(o[m]))),i.upload.onprogress=A||null,i.onerror=i.ontimeout=i.onabort=m=>(de(i),a==null||a.removeEventListener("abort",U),Y({error:m.type,url:r,method:t})),i.onload=()=>{let m={data:this.getResponseBody(i,c),status:i.status,headers:this.getResponseHeaders(i)};return de(i),a==null||a.removeEventListener("abort",U),Se(m.status)?E(m):Y(m);},i.send(s);});}getResponseHeaders(e){return e.getAllResponseHeaders().split(/[\r\n]+/).reduce((s,o)=>{let[r,c]=o.split(": ");return r&&(s[r.toLowerCase()]=c),s;},{});}getResponseBody(e,t){let s=typeof e.response>"u"?e.responseText:e.response;if(t==="json"&&s&&typeof s=="string")try{s=JSON.parse(s);}catch{}return s;}},Pe=new R("uploadx.ajax",{factory:()=>new X(ye),providedIn:"root"}),B=class{constructor(){this.onCancel=()=>{};}cancel(){this.onCancel(),this.onCancel=()=>{};}},me=1024,l=class n{static scale(e){let t=n.size/e;return t<n.minChunkTime&&(n.size=Math.min(n.maxSize,n.size*2)),t>n.maxChunkTime&&(n.size=Math.max(n.minSize,n.size/2)),n.size;}};l.maxSize=Number.MAX_SAFE_INTEGER;l.minSize=256*me;l.size=4*(256*me);l.minChunkTime=8;l.maxChunkTime=24;function q(n,e){return(n.match(e)||[""])[0];}function pe(n,e){return n.indexOf("https://")*n.indexOf("http://")===0?n:n.indexOf("//")===0?q(e,/^(https?:)/)+n:n.indexOf("/")===0?q(e,/^(?:https?:)?(?:\/\/)?([^\/?]+)/)+n:q(e,/^(?:https?:)?(?:\/\/)?([^\/?]+)?(.*\/)/)+n;}function I(n,e){return n instanceof Function?n(e):n;}var he=(n,e)=>{let t={};return e.forEach(s=>t[s]=n[s]),t;};function G(n){return n===Number(n);}function ge(n){let e=2166136261,t=n.length;for(let s=0;s<t;s++)e^=n.charCodeAt(s),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0;}function K(){return![typeof window,typeof navigator].includes("undefined");}function ve(){return K()?navigator.onLine:!0;}function be(){return K()&&/iPad|iPhone/.test(navigator.userAgent);}function Ae(){let n=/OS (\d+)_(\d+)_?(\d+)?/.exec(navigator.userAgent);if(n!=null&&n.length)return n[1]+"."+n[2]+"."+n[3]||"0";}function Me(n,e){return n.localeCompare(e,void 0,{numeric:!0});}function Ee(){return be()&&Me(Ae()||"0.0","15.3")<0;}var Re=Ee()?{chunkSize:0,retryConfig:{shouldRetry:()=>!1}}:{},De=(()=>{class n{generateId(t){let s=JSON.stringify(W(g({},t.metadata),{type:t.constructor.name,endpoint:t.endpoint}));return ge(t.name+t.size).toString(16)+ge(s).toString(16);}}return n.ɵfac=function(t){return new(t||n)();},n.ɵprov=k({token:n,factory:n.ɵfac,providedIn:"root"}),n;})(),_=function(n){return n[n.NotFound=0]="NotFound",n[n.Auth=1]="Auth",n[n.Retryable=2]="Retryable",n[n.Fatal=3]="Fatal",n;}(_||{}),Te={maxAttempts:8,shouldRestartCodes:[404,410],authErrorCodes:[401],shouldRetryCodes:[408,423,429,460],shouldRetry(n){return n<400||n>=500||this.shouldRetryCodes.includes(n);},minDelay:500,maxDelay:5e4,onBusyDelay:1e3,timeout:0,keepPartial(n){return n>=400;}},V=class{constructor(e={}){this.attempts=0,this.cancel=()=>{},this.config=Object.assign({},Te,e);}kind(e){return this.attempts++,this.attempts>this.config.maxAttempts?_.Fatal:this.config.authErrorCodes.includes(e)?_.Auth:this.config.shouldRestartCodes.includes(e)?_.NotFound:this.config.shouldRetry(e,this.attempts)?_.Retryable:_.Fatal;}wait(e){let t=e||Math.min(2**(this.attempts-1)*this.config.minDelay,this.config.maxDelay),s=Math.floor(Math.random()*this.config.minDelay*this.attempts),o;return new Promise(r=>{this.cancel=()=>{clearTimeout(o),r();},o=setTimeout(this.cancel,t+s);});}observe(e){this.observedValue!==e&&(this.attempts=0),this.observedValue=e;}},fe=1e3*60*60,J=class{constructor(e="UPLOADX-v4.0-"){this.prefix=e,this.ttl=24*fe;}set(e,t){this.ttl&&localStorage.setItem(this.prefix+e,JSON.stringify([t,Date.now()+this.ttl]));}get(e){let t=localStorage.getItem(this.prefix+e);if(t){let[s,o]=JSON.parse(t);return s&&o?s:null;}return null;}delete(e){localStorage.removeItem(this.prefix+e);}clear(e=0){this.ttl=e*fe;let t=Date.now();this.keys().forEach(s=>{let o=localStorage.getItem(s);if(o&&e){let[,r]=JSON.parse(o);t>Number(r)&&localStorage.removeItem(s);}else localStorage.removeItem(s);});}keys(){return Object.keys(localStorage).filter(e=>e.indexOf(this.prefix)===0);}},b=xe()?new J():new Map();function xe(){try{let n="LocalStorageTest",e="value";localStorage.setItem(n,e);let t=localStorage.getItem(n);return localStorage.removeItem(n),t===e;}catch{return!1;}}var we={pause:"paused",upload:"queue",cancel:"cancelled",update:"updated"},Q=class{constructor(e,t,s,o){this.file=e,this.options=t,this.stateChange=s,this.ajax=o,this.response=null,this.responseStatus=0,this.responseHeaders={},this.progress=0,this.speed=0,this.headers={},this.endpoint="/upload",this.chunkSize=0,this.canceler=new B(),this.abortController=new AbortController(),this._eventsCount=0,this._url="",this.updateToken=()=>I(this.token||"",this.responseStatus),this.cleanup=()=>{b.delete(this._url),b.delete(this.uploadId);},this.retry=new V(t.retryConfig),this.name=e.name,this.size=e.size,this.metadata={name:e.name,mimeType:e.type||"application/octet-stream",size:e.size,lastModified:e.lastModified},t.maxChunkSize&&(l.maxSize=t.maxChunkSize),this._prerequest=t.prerequest||(r=>r),this._authorize=t.authorize||(r=>r),this.configure(t);}get url(){return this._url||b.get(this.uploadId)||"";}set url(e){this._url!==e&&b.set(this.uploadId,e),this._url=e;}get status(){return this._status;}set status(e){e!=="updated"&&e!=="cancelled"&&(this._status===e||this._status==="complete")||this._status!=="cancelled"&&(this._status==="uploading"&&e==="queue"||(this._status==="retry"&&this.retry.cancel(),this._status=e,e==="paused"&&this.abort(),(e==="cancelled"||e==="complete"||e==="error")&&this.cleanup(),e==="cancelled"?this.cancelAndSendState():e==="updated"?this.updateAndSendState():this.stateChange(this)));}configure({metadata:e,headers:t,token:s,endpoint:o,action:r}){o&&(this.endpoint=o),s&&(this.token=s),e&&Object.assign(this.metadata,I(e,this.file)),t&&Object.assign(this.headers,I(t,this.file)),r&&(this.status=we[r]);}upload(){return h(this,null,function*(){do{this.status="uploading";try{this._token||(this._token=yield this.updateToken()),this.url||(this.url=yield this.getFileUrl()),this.offset!==this.size&&(this.offset=G(this.offset)?yield this.sendFileContent():yield this.getOffset()),this.retry.observe(this.offset),this.offset===this.size?(this.remaining=0,this.progress=100,this.status="complete"):G(this.offset)||(this.stateChange(this),yield this.retry.wait(this.getRetryAfterFromBackend()||this.retry.config.onBusyDelay));}catch(e){if(e instanceof Error&&console.error(e),this.status!=="uploading")return;switch(this.retry.kind(this.responseStatus)){case _.Fatal:this.status="error";return;case _.NotFound:this.url="";break;case _.Auth:this._token="";break;default:I(this.retry.config.keepPartial,this.responseStatus)&&(this.offset=void 0),this.status="retry",yield this.retry.wait(this.getRetryAfterFromBackend());}}}while(["uploading","retry","updated"].includes(this._status));});}request(e){return h(this,null,function*(){var M;this.responseStatus=0,this.response=null,this.responseHeaders={},this.abortController.signal.aborted&&(this.abortController=new AbortController());let t=e.signal||this.abortController.signal,s={body:e.body||null,canceler:this.canceler,signal:t,headers:g(g({},this.headers),e.headers),method:e.method||"GET",url:e.url||this.url};e.skipAuthorization||(s=yield this._authorize(s,this._token));let{body:o=null,headers:r,method:c,url:a=s.url}=(yield this._prerequest(s))||s,A={method:c,headers:g(g({},s.headers),r),url:a,data:o,responseType:(M=this.options.responseType)!=null?M:this.responseType,withCredentials:!!this.options.withCredentials,canceler:this.canceler,signal:t,validateStatus:()=>!0,timeout:this.retry.config.timeout};G(this.offset)&&o&&typeof o=="object"&&(A.onUploadProgress=this.onProgress());let O=yield this.ajax.request(A);if(this.response=O.data,this.responseHeaders=O.headers,this.responseStatus=O.status,O.status>=400)return Promise.reject();});}update(e){return Promise.reject("Not implemented");}abort(){this.offset=void 0,this.abortController.abort(),this.canceler.cancel();}cancel(){return h(this,null,function*(){this.abort(),this.url&&(yield this.request({method:"DELETE"}).catch(()=>{}));});}getValueFromResponse(e){return this.responseHeaders[e.toLowerCase()]||null;}getChunk(e,t){var c;this.responseStatus===413&&(l.maxSize=l.size=Math.floor(l.size/2)),this.chunkSize=this.options.chunkSize===0?this.size:this.options.chunkSize||l.size;let s=(c=e!=null?e:this.offset)!=null?c:0,o=Math.min(s+(t||this.chunkSize),this.size),r=this.file.slice(s,o);return{start:s,end:o,body:r};}getRetryAfterFromBackend(){return Number(this.getValueFromResponse("retry-after"))*1e3;}cancelAndSendState(){this.cancel().then(()=>this.stateChange(this),console.error);}updateAndSendState(){this.update({metadata:this.metadata}).then(()=>this.stateChange(this),console.error);}onProgress(){let e,t=Date.now();return({loaded:s})=>{let o=s/((Date.now()-t)/1e3);if(this.speed=~~((this.speed*this._eventsCount+o)/++this._eventsCount),l.scale(this.speed),!e){e=setTimeout(()=>e=void 0,500);let r=(this.offset||0)+s;this.progress=+(r/this.size*100).toFixed(2),this.remaining=~~((this.size-r)/this.speed),this.stateChange(this);}};}},Z=class extends Q{constructor(){super(...arguments),this.responseType="json";}getFileUrl(){return h(this,null,function*(){let e=JSON.stringify(this.metadata),t={"Content-Type":"application/json; charset=utf-8","X-Upload-Content-Length":this.size,"X-Upload-Content-Type":this.file.type||"application/octet-stream"};yield this.request({method:"POST",body:e,url:this.endpoint,headers:t}),this.offset=this.getOffsetFromResponse()||(this.responseStatus===201?0:void 0);let s=this.getValueFromResponse("location");if(!s)throw new Error("Invalid or missing Location header");return pe(s,this.endpoint);});}sendFileContent(){return h(this,null,function*(){let{body:e,start:t,end:s}=this.getChunk(),o={"Content-Type":"application/octet-stream","Content-Range":`bytes ${t}-${s-1}/${this.size}`};return yield this.request({method:"PUT",body:e,headers:o}),this.responseStatus>201?this.getOffsetFromResponse():s;});}getOffset(){return h(this,null,function*(){let e={"Content-Type":"application/octet-stream","Content-Range":`bytes */${this.size}`};return yield this.request({method:"PUT",headers:e}),this.responseStatus>201?this.getOffsetFromResponse():this.size;});}update(e){return h(this,null,function*(){let t=JSON.stringify(e),s={"Content-Type":"application/json; charset=utf-8"};yield this.request({method:"PATCH",body:t,headers:s});let o=this.getValueFromResponse("location")||this.url;return pe(o,this.endpoint);});}getOffsetFromResponse(){let e=this.getValueFromResponse("Range");return e?Ne(e)+1:void 0;}};function Ne(n=""){let e=parseInt(n.split(/-/)[1],10);return e>=0?e:-1;}var Ie={endpoint:"/upload",autoUpload:!0,concurrency:2,uploaderClass:Z,authorize:(n,e)=>(e&&(n.headers.Authorization=`Bearer ${e}`),n),storeIncompleteHours:24},Ue=new R("uploadx.factory.options",{providedIn:"root",factory:()=>Ie}),Le=new R("uploadx.options");var _e=["file","name","progress","remaining","response","responseHeaders","responseStatus","size","speed","status","uploadId","url"],ke=5,gt=(()=>{class n{constructor(){this.queue=[],this.eventsStream=new ee(),this.subs=[],this.ngZone=y(oe),this.ajax=y(Pe),this.idService=y(De),this.stateChange=o=>{this.ngZone.run(()=>this.eventsStream.next(he(o,_e))),o.status!=="uploading"&&o.status!=="added"&&this.ngZone.runOutsideAngular(()=>setTimeout(()=>this.processQueue()));};let t=y(Le,{optional:!0}),s=y(Ue);this.options=Object.assign({},s,t),K()&&this.subs.push(L(window,"online").subscribe(()=>this.control({action:"upload"})),L(window,"offline").subscribe(()=>this.control({action:"pause"})));}get events(){return this.eventsStream.asObservable();}init(t={}){return Object.assign(this.options,t),this.events;}connect(t){return this.init(t).pipe(te(()=>this.queue),ne(ke));}disconnect(){this.queue.forEach(t=>t.status="paused"),this.queue=[];}state(){return this.queue.map(t=>he(t,_e));}ngOnDestroy(){this.disconnect(),this.subs.forEach(t=>t.unsubscribe());}handleFiles(t,s={}){let o=g(g(g({},this.options),Re),s);b.clear(o.storeIncompleteHours),this.options.concurrency=o.concurrency,("name"in t?[t]:Array.from(t)).forEach(r=>this.addUploaderInstance(r,o));}control(t){(t.uploadId?this.queue.filter(({uploadId:o})=>o===t.uploadId):this.queue).forEach(o=>o.configure(t));}get activeUploadsCount(){return this.queue.filter(({status:t})=>t==="uploading"||t==="retry").length;}request(t){return h(this,null,function*(){return t.data||(t.data=t.body),this.ajax.request(t);});}addUploaderInstance(t,s){return h(this,null,function*(){let o=new s.uploaderClass(t,s,this.stateChange,this.ajax);o.uploadId=yield this.idService.generateId(o),this.queue.push(o),o.status="added",s.autoUpload&&ve()&&(o.status="queue");});}processQueue(){this.queue=this.queue.filter(({status:t})=>t!=="cancelled"),this.queue.filter(({status:t})=>t==="queue").slice(0,Math.max(this.options.concurrency-this.activeUploadsCount,0)).forEach(t=>t.upload());}}return n.ɵfac=function(t){return new(t||n)();},n.ɵprov=k({token:n,factory:n.ɵfac,providedIn:"root"}),n;})();var ze=n=>({width:n}),Fe=()=>({width:"100%"});function He(n,e){n&1&&(f(0,"span"),j(1,0),d());}function je(n,e){if(n&1&&(f(0,"span"),N(1),d()),n&2){let t=C(2);u(),$("",t.uploadPercents,"%");}}function $e(n,e){if(n&1){let t=H();f(0,"input",10),v("click",function(){D(t);let o=C(2);return T(o.cancel.emit());}),d();}}function qe(n,e){if(n&1&&(f(0,"div",5)(1,"div",6)(2,"div",7),w(3,He,2,0,"span",8)(4,je,2,1,"span",8),d()(),w(5,$e,1,0,"input",9),d()),n&2){let t=C();u(2),F(ce(7,ze,t.uploadPercents+"%")),z("aria-valuenow",t.uploadPercents)("aria-valuemax",100),u(),S("ngIf",t.uploadPercents===100&&t.uploaded===!1),u(),S("ngIf",t.uploadPercents!==100||t.uploaded),u(),S("ngIf",t.uploaded===!1);}}function Ge(n,e){if(n&1){let t=H();f(0,"div",11)(1,"div",12)(2,"div",13)(3,"span"),N(4),d()()(),f(5,"input",14),v("click",function(){D(t);let o=C();return T(o.retry.emit());}),d(),f(6,"input",15),v("click",function(){D(t);let o=C();return T(o.cancel.emit());}),d()();}if(n&2){let t=C();u(2),F(ae(5,Fe)),z("aria-valuenow",100)("aria-valuemax",100),u(2),re(t.error);}}function Xe(n,e){if(n&1&&(f(0,"div",16)(1,"div"),j(2,1),d(),N(3),d()),n&2){let t=C();u(3),$(" ",t.error,`
`);}}var P=class P{constructor(){p(this,"isUploading");p(this,"uploadPercents");p(this,"error");p(this,"uploaded");p(this,"enableRetryAfterError");p(this,"cancel",new x());p(this,"retry",new x());}};p(P,"\u0275fac",function(t){return new(t||P)();}),p(P,"\u0275cmp",se({type:P,selectors:[["my-upload-progress"]],inputs:{isUploading:"isUploading",uploadPercents:"uploadPercents",error:"error",uploaded:"uploaded",enableRetryAfterError:"enableRetryAfterError"},outputs:{cancel:"cancel",retry:"retry"},standalone:!0,features:[ie],decls:3,vars:3,consts:()=>{let e;e="Total uploaded";let t;t="Anuluj";let s;s="Przetwarzanie\u2026";let o;o="spr\xF3buj ponownie";let r;r="Anuluj";let c;return c="Przepraszamy, ale co\u015B posz\u0142o nie tak",[s,c,["class","upload-progress-cancel",4,"ngIf"],["class","upload-progress-retry",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"upload-progress-cancel"],["title",e,1,"progress"],["role","progressbar","aria-valuemin","0",1,"progress-bar"],[4,"ngIf"],["type","button","class","peertube-button grey-button ms-1","value",t,3,"click",4,"ngIf"],["type","button","value",t,1,"peertube-button","grey-button","ms-1",3,"click"],[1,"upload-progress-retry"],[1,"progress"],["role","progressbar","aria-valuemin","0",1,"progress-bar","red"],["type","button","value",o,1,"peertube-button","grey-button","ms-1",3,"click"],["type","button","value",r,1,"peertube-button","grey-button","ms-1",3,"click"],[1,"alert","alert-danger"]];},template:function(t,s){t&1&&w(0,qe,6,9,"div",2)(1,Ge,7,6,"div",3)(2,Xe,4,1,"div",4),t&2&&(S("ngIf",s.isUploading&&!s.error),u(),S("ngIf",s.error&&s.enableRetryAfterError),u(),S("ngIf",s.error&&!s.enableRetryAfterError));},dependencies:[ue,le],styles:[".upload-progress-retry[_ngcontent-%COMP%], .upload-progress-cancel[_ngcontent-%COMP%]{display:flex;margin-bottom:40px}.upload-progress-retry[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%], .upload-progress-cancel[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{flex-grow:1;background-color:#0bcc2929;display:flex;height:30px;overflow:hidden;font-size:14px;border-radius:.25rem;position:relative}.upload-progress-retry[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .upload-progress-cancel[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;color:var(--greyForegroundColor)}.upload-progress-retry[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(1), .upload-progress-cancel[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(1){left:.2rem}.upload-progress-retry[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(2), .upload-progress-cancel[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(2){right:.2rem}.upload-progress-retry[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%], .upload-progress-cancel[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{color:var(--mainBackgroundColor);background-color:var(--mainColor);display:flex;flex-direction:column;justify-content:center;text-align:center;white-space:nowrap;transition:width .6s ease}.upload-progress-retry[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar.red[_ngcontent-%COMP%], .upload-progress-cancel[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar.red[_ngcontent-%COMP%]{background-color:#d56253}.upload-progress-retry[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%], .upload-progress-cancel[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{background-color:#38ab0b;line-height:30px;text-align:start;font-weight:600}.upload-progress-retry[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .upload-progress-cancel[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--mainBackgroundColor);margin-inline-start:.8125rem}"]}));var Ce=P;export{pe as a,Z as b,gt as c,Ce as d};/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/