import{a as D}from"./chunk-4XL6BJ7M.js";import{a as K,b as X}from"./chunk-RBCGTDIC.js";import{a as Y}from"./chunk-DPQ4XGHN.js";import{$ as h,B as d,Bf as z,C as L,D as C,Fc as k,Gc as g,Jc as $,Kc as w,Kd as p,Nd as M,Of as G,Pd as j,Qf as J,R as f,Ue as y,Y as O,gg as A,hg as Q,i as R,j as H,k as F,kg as q,m as U,md as S,rd as N,ug as B,zf as W}from"./chunk-4A7FW7VV.js";import{a as b,b as _,j as n}from"./chunk-K6ICEIKK.js";var I=class extends D{constructor(t,r={}){super(t,r);n(this,"descriptionPath");n(this,"support");n(this,"tags");n(this,"downloadEnabled");n(this,"commentsEnabled");n(this,"commentsPolicy");n(this,"likesPercent");n(this,"dislikesPercent");n(this,"trackerUrls");n(this,"inputFileUpdatedAt");this.descriptionPath=t.descriptionPath,this.channel=new Y(t.channel),this.account=new z(t.account),this.tags=t.tags,this.support=t.support,this.commentsPolicy=t.commentsPolicy,this.downloadEnabled=t.downloadEnabled,this.inputFileUpdatedAt=t.inputFileUpdatedAt,this.trackerUrls=t.trackerUrls,this.buildLikeAndDislikePercents();}buildLikeAndDislikePercents(){this.likesPercent=this.likes/(this.likes+this.dislikes)*100,this.dislikesPercent=this.dislikes/(this.likes+this.dislikes)*100;}getHlsPlaylist(){return this.streamingPlaylists.find(t=>t.type===M.HLS);}hasHlsPlaylist(){return!!this.getHlsPlaylist();}};var o=class o{constructor(e,t,r,i,s,a){this.auth=e;this.authHttp=t;this.restExtractor=r;this.restService=i;this.serverService=s;this.confirmService=a;}getVideoViewUrl(e){return`${o.BASE_VIDEO_URL}/${e}/views`;}getVideo(e){let t=P.buildVideoPasswordHeader(e.videoPassword);return this.serverService.getServerLocale().pipe(f(r=>this.authHttp.get(`${o.BASE_VIDEO_URL}/${e.videoId}`,{headers:t}).pipe(U(i=>({videoHash:i,translations:r})))),U(({videoHash:r,translations:i})=>new I(r,i)),d(r=>this.restExtractor.handleError(r)));}updateVideo(e){let t=e.language||null,r=e.licence||null,i=e.category||null,s=e.description||null,a=e.support||null,c=e.scheduleUpdate||null,u=e.originallyPublishedAt||null,V={name:e.name,category:i,licence:r,language:t,support:a,description:s,channelId:e.channelId,privacy:e.privacy,videoPasswords:e.privacy===p.PASSWORD_PROTECTED?[e.videoPassword]:void 0,tags:e.tags,nsfw:e.nsfw,waitTranscoding:e.waitTranscoding,commentsPolicy:e.commentsPolicy,downloadEnabled:e.downloadEnabled,thumbnailfile:e.thumbnailfile,previewfile:e.previewfile,pluginData:e.pluginData,scheduleUpdate:c,originallyPublishedAt:u},m=W(V);return this.authHttp.put(`${o.BASE_VIDEO_URL}/${e.id}`,m).pipe(d(v=>this.restExtractor.handleError(v)));}uploadVideo(e){let t=new $("POST",`${o.BASE_VIDEO_URL}/upload`,e,{reportProgress:!0});return this.authHttp.request(t).pipe(d(r=>this.restExtractor.handleError(r)));}getMyVideos(e){let{videoPagination:t,sort:r,userChannels:i=[],search:s}=e,a=this.restService.componentToRestPagination(t),c=new g();if(c=this.restService.addRestGetParams(c,a,r),s){let u=this.restService.parseQueryStringFilter(s,{isLive:{prefix:"isLive:",isBoolean:!0},channelId:{prefix:"channel:",handler:V=>{let m=i.find(v=>v.name===V);if(m)return m.id;}}});c=this.restService.addObjectParams(c,u);}return this.authHttp.get(B.BASE_USERS_URL+"me/videos",{params:c}).pipe(f(u=>this.extractVideos(u)),d(u=>this.restExtractor.handleError(u)));}getAccountVideos(e){let{account:t,search:r}=e,i=new g();return i=this.buildCommonVideosParams(b({params:i},e)),r&&(i=i.set("search",r)),this.authHttp.get(K.BASE_ACCOUNT_URL+t.nameWithHost+"/videos",{params:i}).pipe(f(s=>this.extractVideos(s)),d(s=>this.restExtractor.handleError(s)));}getVideoChannelVideos(e){let{videoChannel:t}=e,r=new g();return r=this.buildCommonVideosParams(b({params:r},e)),this.authHttp.get(X.BASE_VIDEO_CHANNEL_URL+t.nameWithHost+"/videos",{params:r}).pipe(f(i=>this.extractVideos(i)),d(i=>this.restExtractor.handleError(i)));}getVideos(e){let t=new g();return t=this.buildCommonVideosParams(b({params:t},e)),this.authHttp.get(o.BASE_VIDEO_URL,{params:t}).pipe(f(r=>this.extractVideos(r)),d(r=>this.restExtractor.handleError(r)));}buildBaseFeedUrls(e,t=o.BASE_FEEDS_URL){let r=[{format:S.RSS,label:"media rss 2.0",url:t+S.RSS.toLowerCase()},{format:S.ATOM,label:"atom 1.0",url:t+S.ATOM.toLowerCase()},{format:S.JSON,label:"json 1.0",url:t+S.JSON.toLowerCase()}];if(e&&e.keys().length!==0)for(let i of r)i.url+="?"+e.toString();return r;}getVideoFeedUrls(e,t,r){let i=this.restService.addRestGetParams(new g(),void 0,e);if(t&&(i=i.set("isLocal",t)),r)for(let s of r)i=i.append("categoryOneOf[]",s+"");return this.buildBaseFeedUrls(i);}getAccountFeedUrls(e){let t=this.restService.addRestGetParams(new g());return t=t.set("accountId",e.toString()),this.buildBaseFeedUrls(t);}getVideoChannelFeedUrls(e){let t=this.restService.addRestGetParams(new g());t=t.set("videoChannelId",e.toString());let r=this.buildBaseFeedUrls(t);return r.push({format:S.RSS,label:"podcast rss 2.0",url:o.PODCAST_FEEDS_URL+`?videoChannelId=${e}`}),r;}getVideoSubscriptionFeedUrls(e,t){let r=this.restService.addRestGetParams(new g());return r=r.set("accountId",e.toString()),r=r.set("token",t),this.buildBaseFeedUrls(r,o.BASE_SUBSCRIPTION_FEEDS_URL);}getVideoFileMetadata(e){return this.authHttp.get(e).pipe(d(t=>this.restExtractor.handleError(t)));}removeVideo(e){let t=j(e);return R(t).pipe(C(r=>this.authHttp.delete(`${o.BASE_VIDEO_URL}/${r}`)),L(),d(r=>this.restExtractor.handleError(r)));}removeVideoFiles(e,t){return R(e).pipe(C(r=>this.authHttp.delete(o.BASE_VIDEO_URL+"/"+r+"/"+t)),L(),d(r=>this.restExtractor.handleError(r)));}removeFile(e,t,r){return this.authHttp.delete(o.BASE_VIDEO_URL+"/"+e+"/"+r+"/"+t).pipe(d(i=>this.restExtractor.handleError(i)));}removeSourceFile(e){return this.authHttp.delete(o.BASE_VIDEO_URL+"/"+e+"/source/file").pipe(d(t=>this.restExtractor.handleError(t)));}runTranscoding(e){let{videos:t,type:r,forceTranscoding:i}=e,s={transcodingType:r,forceTranscoding:i};return R(t).pipe(C(a=>this.authHttp.post(o.BASE_VIDEO_URL+"/"+a.uuid+"/transcoding",s).pipe(d(c=>{var u;if(((u=c.error)==null?void 0:u.code)===N.VIDEO_ALREADY_BEING_TRANSCODED&&!i){let V="PeerTube considers video \""+a.name+"\" is already being transcoded."+" If you think PeerTube is wrong (video in broken state after a crash etc.), you can force transcoding on this video."+" Do you still want to run transcoding?";return R(this.confirmService.confirm(V,"Force transcoding")).pipe(f(m=>m===!1?F(()=>c):this.runTranscoding({videos:[a],type:r,forceTranscoding:!0})));}return F(()=>c);}))),L(),d(a=>this.restExtractor.handleError(a)));}generateDownloadUrl(e){let{video:t,files:r}=e;if(r.length===0)throw new Error("Cannot generate download URL without files");let i=`${o.BASE_VIDEO_DOWNLOAD_URL}/${t.uuid}?`;return i+=r.map(s=>"videoFileIds="+s.id).join("&"),i;}getStoryboards(e,t){let r=P.buildVideoPasswordHeader(t);return this.authHttp.get(o.BASE_VIDEO_URL+"/"+e+"/storyboards",{headers:r}).pipe(U(({storyboards:i})=>i),d(i=>i.status===404?H([]):this.restExtractor.handleError(i)));}getSource(e){return this.authHttp.get(o.BASE_VIDEO_URL+"/"+e+"/source").pipe(d(t=>t.status===404?H(void 0):this.restExtractor.handleError(t)));}setVideoLike(e,t){return this.setVideoRate(e,"like",t);}setVideoDislike(e,t){return this.setVideoRate(e,"dislike",t);}unsetVideoLike(e,t){return this.setVideoRate(e,"none",t);}getUserVideoRating(e){let t=B.BASE_USERS_URL+"me/videos/"+e+"/rating";return this.authHttp.get(t).pipe(d(r=>this.restExtractor.handleError(r)));}extractVideos(e){return this.serverService.getServerLocale().pipe(U(t=>{let r=e.data,i=e.total,s=[];for(let a of r)s.push(new D(a,t));return{total:i,data:s};}));}explainedPrivacyLabels(e,t=p.PUBLIC){var s;let r={[p.PRIVATE]:"Tylko ja mog\u0119 zobaczy\u0107 ten film",[p.UNLISTED]:"Udost\u0119pniane tylko przez prywatny odno\u015Bnik",[p.PUBLIC]:"Ka\u017Cdy mo\u017Ce zobaczy\u0107 ten film",[p.INTERNAL]:"Tylko u\u017Cytkownicy tej instancji mog\u0105 zobaczy\u0107 ten film",[p.PASSWORD_PROTECTED]:"Only users with the appropriate password can see this video"};return{videoPrivacies:e.map(a=>_(b({},a),{description:r[a.id]})),defaultPrivacyId:((s=e.find(a=>a.id===t))==null?void 0:s.id)||e[0].id};}getHighestAvailablePrivacy(e){let t=[p.PRIVATE,p.INTERNAL,p.UNLISTED,p.PUBLIC];for(let r of t)if(e.find(i=>i.id===r))return r;throw new Error("No highest privacy available");}nsfwPolicyToParam(e){return e==="do_not_list"?"false":"both";}buildDefaultOwnerDisplayType(e){let t=e.account.name;return e.channel.displayName===`Default ${t} channel`||e.channel.displayName===`Main ${t} channel`||e.channel.name.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/)?"account":"videoChannel";}buildCommonVideosParams(e){let{params:t,videoPagination:r,sort:i,isLocal:s,include:a,categoryOneOf:c,languageOneOf:u,privacyOneOf:V,skipCount:m,isLive:v,nsfw:x}=e,Z=r?this.restService.componentToRestPagination(r):void 0,l=this.restService.addRestGetParams(t,Z,this.buildListSort(i));return m&&(l=l.set("skipCount",m+"")),s!==void 0&&(l=l.set("isLocal",s)),a!==void 0&&(l=l.set("include",a)),v!==void 0&&(l=l.set("isLive",v)),x!==void 0&&(l=l.set("nsfw",x)),u!==void 0&&(l=this.restService.addArrayParams(l,"languageOneOf",u)),c!==void 0&&(l=this.restService.addArrayParams(l,"categoryOneOf",c)),V!==void 0&&(l=this.restService.addArrayParams(l,"privacyOneOf",V)),l;}buildListSort(e){let t=this.restService.buildSortString(e);if(typeof t=="string")return this.auth.isLoggedIn()&&(t==="hot"||t==="-hot")?t.replace("hot","best"):t;}setVideoRate(e,t,r){let i=`${o.BASE_VIDEO_URL}/${e}/rate`,s={rating:t},a=P.buildVideoPasswordHeader(r);return this.authHttp.put(i,s,{headers:a}).pipe(d(c=>this.restExtractor.handleError(c)));}};n(o,"BASE_VIDEO_DOWNLOAD_URL",y.originServerUrl+"/download/videos/generate"),n(o,"BASE_VIDEO_URL",y.apiUrl+"/api/v1/videos"),n(o,"BASE_FEEDS_URL",y.apiUrl+"/feeds/videos."),n(o,"PODCAST_FEEDS_URL",y.apiUrl+"/feeds/podcast/videos.xml"),n(o,"BASE_SUBSCRIPTION_FEEDS_URL",y.apiUrl+"/feeds/subscriptions."),n(o,"\u0275fac",function(t){return new(t||o)(h(Q),h(w),h(A),h(q),h(J),h(G));}),n(o,"\u0275prov",O({token:o,factory:o.ɵfac}));var T=o;var E=class E{constructor(e,t){this.authHttp=e;this.restExtractor=t;}static buildVideoPasswordHeader(e){return e?new k().set("x-peertube-video-password",e):void 0;}getVideoPasswords(e){return this.authHttp.get(`${T.BASE_VIDEO_URL}/${e.videoUUID}/passwords`).pipe(f(t=>t.data),d(t=>this.restExtractor.handleError(t)));}};n(E,"\u0275fac",function(t){return new(t||E)(h(w),h(A));}),n(E,"\u0275prov",O({token:E,factory:E.ɵfac}));var P=E;export{I as a,P as b,T as c};/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/