import{Da as l,H as m,N as u,Q as h,Rf as S,U as p,da as b,m as a,s as c,sa as f,ua as d,x as s}from"./chunk-4A7FW7VV.js";import{j as t}from"./chunk-K6ICEIKK.js";var n=class n{constructor(e,r){this.peertubeRouter=e;this.el=r;t(this,"percentLimit",70);t(this,"onItself",!1);t(this,"dataObservable");t(this,"setAngularState");t(this,"parentDisabled",!1);t(this,"nearOfBottom",new f);t(this,"decimalLimit",0);t(this,"lastCurrentBottom",-1);t(this,"scrollDownSub");t(this,"container");t(this,"checkScroll",!1);this.decimalLimit=this.percentLimit/100}ngAfterViewChecked(){this.checkScroll&&(this.checkScroll=!1,setTimeout(()=>{this.hasScroll()===!1&&this.nearOfBottom.emit()}))}ngOnInit(){this.initialize()}ngOnDestroy(){this.scrollDownSub&&this.scrollDownSub.unsubscribe()}initialize(){this.container=this.onItself?this.el.nativeElement:document.documentElement;let e={leading:!0,trailing:!0},r=this.onItself?this.container:window,g=c(r,"scroll").pipe(h(!0),p(200,void 0,e),a(()=>this.getScrollInfo()),m((i,o)=>i.current===o.current),u());this.scrollDownSub=g.pipe(s(({current:i})=>this.isScrollingDown(i)),s(({current:i,maximumScroll:o})=>i/o>this.decimalLimit)).subscribe(()=>{this.setAngularState&&!this.parentDisabled&&this.setScrollRouteParams(),this.nearOfBottom.emit()}),this.dataObservable&&this.dataObservable.pipe(s(i=>i.length!==0)).subscribe(()=>this.checkScroll=!0)}getScrollInfo(){return{current:this.container.scrollTop,maximumScroll:this.getMaximumScroll()}}getMaximumScroll(){let e=this.onItself?this.container.clientHeight:window.innerHeight;return this.container.scrollHeight-e}hasScroll(){return this.getMaximumScroll()>0}isScrollingDown(e){let r=this.lastCurrentBottom<e;return this.lastCurrentBottom=e,r}setScrollRouteParams(){this.peertubeRouter.addRouteSetting(1)}};t(n,"\u0275fac",function(r){return new(r||n)(l(S),l(d))}),t(n,"\u0275dir",b({type:n,selectors:[["","myInfiniteScroller",""]],inputs:{percentLimit:"percentLimit",onItself:"onItself",dataObservable:"dataObservable",setAngularState:"setAngularState",parentDisabled:"parentDisabled"},outputs:{nearOfBottom:"nearOfBottom"},standalone:!0}));var v=n;export{v as a};
/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/
