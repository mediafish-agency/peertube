import{b as R,c as l}from"./chunk-GP5LX4CA.js";import{$ as d,B as c,C as v,D as g,Kc as C,Of as A,Qd as y,Qf as D,R as p,Ue as V,Y as h,gg as O,i as b,j as u,k as E,m as s,qe as S,rd as f,zf as T}from"./chunk-4A7FW7VV.js";import{j as m}from"./chunk-K6ICEIKK.js";var n=class n{constructor(t,i,r,e){this.authHttp=t;this.serverService=i;this.restExtractor=r;this.confirmService=e;}listCaptions(t,i){let r=R.buildVideoPasswordHeader(i);return this.authHttp.get(`${l.BASE_VIDEO_URL}/${t}/captions`,{headers:r}).pipe(p(e=>this.serverService.getServerLocale().pipe(s(o=>({captionsResult:e,translations:o})))),s(({captionsResult:e,translations:o})=>{for(let a of e.data)a.language.label=S(a.language.label,o);return e;}),s(e=>(y(e.data,"language","label"),e))).pipe(c(e=>this.restExtractor.handleError(e)));}removeCaption(t,i){return this.authHttp.delete(`${l.BASE_VIDEO_URL}/${t}/captions/${i}`).pipe(c(r=>this.restExtractor.handleError(r)));}addCaption(t,i,r){let o=T({captionfile:r});return this.authHttp.put(`${l.BASE_VIDEO_URL}/${t}/captions/${i}`,o).pipe(c(a=>this.restExtractor.handleError(a)));}updateCaptions(t,i){let r=u(void 0);for(let e of i)e.action==="CREATE"||e.action==="UPDATE"?r=r.pipe(p(()=>this.addCaption(t,e.language.id,e.captionfile))):e.action==="REMOVE"&&(r=r.pipe(p(()=>this.removeCaption(t,e.language.id))));return r;}getCaptionContent({captionPath:t}){return this.authHttp.get(V.originServerUrl+t,{responseType:"text"});}generateCaption(t){let{videos:i}=t;return b(i).pipe(g(r=>this.generateCaptionOfSpecificVideo({video:r,forceTranscription:!1})),v(),s(r=>r.reduce((e,o)=>(o==="success"&&(e.success+=1),o==="already-has-captions"&&(e.alreadyHasCaptions+=1),o==="already-being-transcribed"&&(e.alreadyBeingTranscribed+=1),e),{success:0,alreadyHasCaptions:0,alreadyBeingTranscribed:0})),c(r=>this.restExtractor.handleError(r)));}generateCaptionOfSpecificVideo(t){let{video:i,forceTranscription:r}=t,e={forceTranscription:r};return this.authHttp.post(`${l.BASE_VIDEO_URL}/${i.id}/captions/generate`,e).pipe(s(()=>"success"),c(o=>{let a=o.error;if((a==null?void 0:a.code)===f.VIDEO_ALREADY_BEING_TRANSCRIBED&&!r){let I="PeerTube\u306F\u3001\u52D5\u753B\""+i.name+"\"\u306E\u6587\u5B57\u8D77\u3053\u3057\u304C\u65E2\u306B\u958B\u59CB\u3055\u308C\u3066\u3044\u308B\u3068\u5224\u65AD\u3057\u307E\u3057\u305F\u3002"+"PeerTube\u5074\u306B\u554F\u984C\u304C\u3042\u308B\uFF08\u30AF\u30E9\u30C3\u30B7\u30E5\u306A\u3069\u304C\u539F\u56E0\u3067\u3001\u52D5\u753B\u304C\u4E88\u671F\u305B\u306C\u72B6\u614B\u3067\u3042\u308B\u306A\u3069\uFF09\u3068\u601D\u308F\u308C\u308B\u5834\u5408\u3001\u3053\u306E\u52D5\u753B\u306E\u6587\u5B57\u8D77\u3053\u3057\u3092\u624B\u52D5\u3067\u5B9F\u884C\u3067\u304D\u307E\u3059\u3002"+" Do you still want to run transcription?";return b(this.confirmService.confirm(I,"\u6587\u5B57\u8D77\u3053\u3057\u3092\u624B\u52D5\u5B9F\u884C")).pipe(p($=>$===!1?E(()=>o):this.generateCaptionOfSpecificVideo({video:i,forceTranscription:!0})));}return(a==null?void 0:a.code)===f.VIDEO_ALREADY_HAS_CAPTIONS?u("already-has-captions"):(a==null?void 0:a.code)===f.VIDEO_ALREADY_BEING_TRANSCRIBED?u("already-being-transcribed"):E(()=>o);}));}};m(n,"\u0275fac",function(i){return new(i||n)(d(C),d(D),d(O),d(A));}),m(n,"\u0275prov",h({token:n,factory:n.Éµfac}));var H=n;export{H as a};/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/