import{j as b,l as c}from"./jschannel-C6bikODZ.js";class R{constructor(){this.eventRegistrations={}}bindToChannel(e){for(const s of Object.keys(this.eventRegistrations))e.bind(s,(o,l)=>this.fire(s,l))}registerTypes(e){for(const s of e)this.eventRegistrations[s]={registrations:[]}}fire(e,s){this.eventRegistrations[e].registrations.forEach(o=>o(s))}addListener(e,s){return this.eventRegistrations[e]?(this.eventRegistrations[e].registrations.push(s),!0):(console.warn("PeerTube: addEventListener(): The event '".concat(e,"' is not supported")),!1)}removeListener(e,s){return this.eventRegistrations[e]?(this.eventRegistrations[e].registrations=this.eventRegistrations[e].registrations.filter(o=>o!==s),!0):!1}}const f=["pause","play","playbackStatusUpdate","playbackStatusChange","resolutionUpdate","volumeChange"];class w{constructor(e,s){this.embedElement=e,this.scope=s,this.eventRegistrar=new R,this.eventRegistrar.registerTypes(f),this.constructChannel(),this.prepareToBeReady()}destroy(){this.embedElement.remove()}addEventListener(e,s){return this.eventRegistrar.addListener(e,s)}removeEventListener(e,s){return this.eventRegistrar.removeListener(e,s)}get ready(){return this.readyPromise}async play(){await this.sendMessage("play")}async pause(){await this.sendMessage("pause")}async setVolume(e){await this.sendMessage("setVolume",e)}async getVolume(){return this.sendMessage("getVolume")}async setCaption(e){await this.sendMessage("setCaption",e)}async getCaptions(){return this.sendMessage("getCaptions")}async seek(e){await this.sendMessage("seek",e)}async setResolution(e){await this.sendMessage("setResolution",e)}async getResolutions(){return this.sendMessage("getResolutions")}async getPlaybackRates(){return this.sendMessage("getPlaybackRates")}async getPlaybackRate(){return this.sendMessage("getPlaybackRate")}async setPlaybackRate(e){await this.sendMessage("setPlaybackRate",e)}async playNextVideo(){await this.sendMessage("playNextVideo")}async playPreviousVideo(){await this.sendMessage("playPreviousVideo")}async getCurrentPosition(){return this.sendMessage("getCurrentPosition")}async setVideoPassword(e){await this.sendMessage("setVideoPassword",e)}async getImageDataUrl(){return this.sendMessage("getImageDataUrl")}constructChannel(){this.channel=b.build({window:this.embedElement.contentWindow,origin:"*",scope:this.scope||"peertube"}),this.eventRegistrar.bindToChannel(this.channel)}prepareToBeReady(){let e,s;this.readyPromise=new Promise((o,l)=>{e=o,s=l}),this.channel.bind("ready",o=>o?e():s()),this.channel.call({method:"isReady",success:o=>o?e():null})}sendMessage(e,s){return new Promise((o,l)=>{this.channel.call({method:e,params:s,success:u=>o(u),error:u=>l(u)})})}}window.PeerTubePlayer=w;window.addEventListener("load",async()=>{const d=window.location.href.split("/"),e=d[d.length-1],s=window.location.pathname.startsWith("/video-playlists/"),o=e.includes("?")?e.split("?")[0]:e,l=document.createElement("iframe");l.src=s?"/video-playlists/embed/".concat(o,"?api=1"):"/videos/embed/".concat(o,"?api=1&waitPasswordFromEmbedAPI=1"),l.sandbox.add("allow-same-origin","allow-scripts","allow-popups","allow-forms"),document.querySelector("#host").appendChild(l),c.info("Document finished loading.");const r=new w(document.querySelector("iframe"));window.player=r,c.info("Awaiting player ready..."),await r.setVideoPassword("toto"),await r.ready,c.info("Player is ready.");const p=()=>{r.getCurrentPosition().then(t=>{document.getElementById("playlist-position").innerHTML=t+""})};["pause","play","playbackStatusUpdate","playbackStatusChange"].forEach(t=>{r.addEventListener(t,i=>{c.info("PLAYER: event '".concat(t,"' received"),{param:i}),t==="playbackStatusChange"&&s&&p()}),s&&p(),c.info("PLAYER: now listening for event '".concat(t,"'"))});let h=[],y=await r.getPlaybackRate();const g=()=>{const t=document.querySelector("#rate-list");t.innerHTML="",h.forEach(i=>{if(y===i){const n=document.createElement("strong");n.innerText="".concat(i," (active)"),n.style.display="block",t.appendChild(n)}else{const n=document.createElement("a");n.href="javascript:;",n.innerText=i.toString(),n.addEventListener("click",()=>{r.setPlaybackRate(i),y=i,g()}),n.style.display="block",t.appendChild(n)}})};r.getPlaybackRates().then(t=>{h=t,g()});const m=async()=>{const t=await r.getCaptions(),i=document.querySelector("#caption-list");i.innerHTML="",t.forEach(n=>{if(n.mode==="showing"){const a=document.createElement("strong");a.innerText="".concat(n.label," (active)"),a.style.display="block",i.appendChild(a)}else{const a=document.createElement("a");a.href="javascript:;",a.innerText=n.label,a.addEventListener("click",()=>{r.setCaption(n.id),m()}),a.style.display="block",i.appendChild(a)}})};m();const v=t=>{const i=document.querySelector("#resolution-list");i.innerHTML="",t.forEach(n=>{if(n.active){const a=document.createElement("strong");a.innerText="".concat(n.label," (active)"),a.style.display="block",i.appendChild(a)}else{const a=document.createElement("a");a.href="javascript:;",a.innerText=n.label,a.addEventListener("click",()=>{r.setResolution(n.id)}),a.style.display="block",i.appendChild(a)}})};r.getResolutions().then(t=>v(t)),r.addEventListener("resolutionUpdate",t=>v(t));const E=t=>{const i=document.getElementById("volume");i.innerText=t*100+"%"};r.getVolume().then(t=>E(t)),r.addEventListener("volumeChange",t=>E(t))});
