import{a as ce}from"./chunk-FLZZWV3F.js";import{o as de}from"./chunk-RXO3LGSG.js";import{a as se}from"./chunk-SPKU4WOP.js";import{c as w}from"./chunk-GP5LX4CA.js";import{a as ae}from"./chunk-GOWSOB6U.js";import{$ as S,$d as J,Ab as T,B as N,Bb as z,Ca as r,Da as c,Gc as U,Ib as M,Kb as _,Kc as G,Oa as v,Qf as P,R as h,Sa as a,T as D,Ue as Q,Vf as Z,Xf as ee,Y as j,Zc as q,_f as te,ab as d,ba as y,bb as s,bd as X,c as A,cb as C,db as $,eb as B,fg as ie,gg as ne,j as I,kb as x,kf as Y,m as R,ob as V,pb as u,qc as H,qe as K,r as L,rc as W,sg as oe,ug as re,zb as b}from"./chunk-4A7FW7VV.js";import{a as E,b as k,j as n}from"./chunk-K6ICEIKK.js";var p=class p{constructor(e,t,i,l){this.authHttp=e;this.restExtractor=t;this.videosService=i;this.serverService=l;}getVideosOverview(e){let t=new U();return t=t.append("page",e+""),this.authHttp.get(p.BASE_OVERVIEW_URL+"videos",{params:t}).pipe(h(i=>this.updateVideosOverview(i)),N(i=>this.restExtractor.handleError(i)));}updateVideosOverview(e){let t=[],i={tags:[],categories:[],channels:[]};for(let l of J(e))for(let m of e[l])t.push(I(m.videos).pipe(h(g=>this.videosService.extractVideos({total:0,data:g})),R(g=>g.data),D(g=>{i[l].push(Y(m,{videos:g}));})));return t.length===0?I(i):L(t).pipe(h(()=>this.serverService.getServerLocale().pipe(D(l=>{for(let m of i.categories)m.category.label=K(m.category.label,l);}))),R(()=>i));}};n(p,"BASE_OVERVIEW_URL",Q.apiUrl+"/api/v1/overviews/"),n(p,"\u0275fac",function(t){return new(t||p)(S(G),S(ne),S(w),S(P));}),n(p,"\u0275prov",j({token:p,factory:p.Éµfac}));var F=p;var ve=o=>[o],fe=o=>({categoryOneOf:o}),Oe=o=>({tagsOneOf:o}),Se=o=>["/c",o];function Ce(o,e){o&1&&(d(0,"div",7),x(1,1),s());}function ye(o,e){if(o&1&&(d(0,"div",14),C(1,"my-video-miniature",15),s()),o&2){let t=e.$implicit,i=u(3);r(),a("video",t)("user",i.userMiniature)("displayVideoActions",!0);}}function Ve(o,e){if(o&1&&(d(0,"div",10)(1,"h1",11)(2,"a",12),b(3),s()(),v(4,ye,2,3,"div",13),s()),o&2){let t=e.$implicit,i=u(2);r(2),a("queryParams",_(5,fe,_(3,ve,t.category.id))),r(),T(t.category.label),r(),a("ngForOf",i.buildVideos(t.videos));}}function be(o,e){if(o&1&&(d(0,"div",14),C(1,"my-video-miniature",15),s()),o&2){let t=e.$implicit,i=u(3);r(),a("video",t)("user",i.userMiniature)("displayVideoActions",!0);}}function Me(o,e){if(o&1&&(d(0,"div",10)(1,"h2",11)(2,"a",12),b(3),s()(),v(4,be,2,3,"div",13),s()),o&2){let t=e.$implicit,i=u(2);r(2),a("queryParams",_(5,Oe,_(3,ve,t.tag))),r(),z("#",t.tag,""),r(),a("ngForOf",i.buildVideos(t.videos));}}function Pe(o,e){if(o&1&&(d(0,"div",14),C(1,"my-video-miniature",15),s()),o&2){let t=e.$implicit,i=u(3);r(),a("video",t)("user",i.userMiniature)("displayVideoActions",!0);}}function we(o,e){if(o&1&&(d(0,"div",16)(1,"div",11)(2,"a",17),C(3,"my-actor-avatar",18),d(4,"h2",11),b(5),s()()(),v(6,Pe,2,3,"div",13),s()),o&2){let t=e.$implicit,i=u(2);r(2),a("routerLink",_(4,Se,i.buildVideoChannelBy(t))),r(),a("actor",i.buildVideoChannel(t)),r(2),T(t.channel.displayName),r(),a("ngForOf",i.buildVideos(t.videos));}}function Fe(o,e){if(o&1&&($(0),v(1,Ve,5,7,"div",8)(2,Me,5,7,"div",8)(3,we,7,6,"div",9),B()),o&2){let t=e.$implicit;r(),a("ngForOf",t.categories),r(),a("ngForOf",t.tags),r(),a("ngForOf",t.channels);}}var f=class f{constructor(e,t,i,l){this.notifier=e;this.userService=t;this.overviewService=i;this.screenService=l;n(this,"onDataSubject",new A());n(this,"overviews",[]);n(this,"notResults",!1);n(this,"userMiniature");n(this,"loaded",!1);n(this,"currentPage",1);n(this,"maxPage",20);n(this,"lastWasEmpty",!1);n(this,"isLoading",!1);n(this,"userSub");}ngOnInit(){this.loadMoreResults(),this.userService.getAnonymousOrLoggedUser().subscribe(e=>this.userMiniature=e),this.userSub=this.userService.listenAnonymousUpdate().pipe(h(()=>this.userService.getAnonymousOrLoggedUser())).subscribe(e=>{this.userMiniature=e,this.overviews=[],this.loadMoreResults();});}ngOnDestroy(){this.userSub&&this.userSub.unsubscribe();}buildVideoChannelBy(e){return e.videos[0].byVideoChannel;}buildVideoChannel(e){return e.videos[0].channel;}buildVideos(e){let t=this.screenService.getNumberOfAvailableMiniatures();return e.slice(0,t*2);}onNearOfBottom(){this.currentPage>=this.maxPage||this.lastWasEmpty||this.isLoading||(this.currentPage++,this.loadMoreResults());}loadMoreResults(){this.isLoading=!0,this.overviewService.getVideosOverview(this.currentPage).subscribe({next:e=>{if(this.isLoading=!1,e.tags.length===0&&e.channels.length===0&&e.categories.length===0){this.lastWasEmpty=!0,this.loaded===!1&&(this.notResults=!0);return;}this.loaded=!0,this.onDataSubject.next(e),this.overviews.push(e);},error:e=>{this.notifier.error(e.message),this.isLoading=!1;}});}};n(f,"\u0275fac",function(t){return new(t||f)(c(ie),c(re),c(F),c(ee));}),n(f,"\u0275cmp",y({type:f,selectors:[["my-video-overview"]],standalone:!0,features:[M],decls:6,vars:3,consts:()=>{let e;e="Kh\xE1m ph\xE1";let t;return t="Kh\xF4ng c\xF3 video n\xE0o.",[e,t,[1,"visually-hidden"],[1,"margin-content"],["class","no-results",4,"ngIf"],["myInfiniteScroller","",3,"nearOfBottom","dataObservable"],[4,"ngFor","ngForOf"],[1,"no-results"],["class","section videos",4,"ngFor","ngForOf"],["class","section channel videos",4,"ngFor","ngForOf"],[1,"section","videos"],[1,"section-title"],["routerLink","/search",1,"link-orange",3,"queryParams"],["class","video-wrapper",4,"ngFor","ngForOf"],[1,"video-wrapper"],[3,"video","user","displayVideoActions"],[1,"section","channel","videos"],[1,"link-orange",3,"routerLink"],["actorType","channel","size","28",3,"actor"]];},template:function(t,i){t&1&&(d(0,"h1",2),x(1,0),s(),d(2,"div",3),v(3,Ce,2,0,"div",4),d(4,"div",5),V("nearOfBottom",function(){return i.onNearOfBottom();}),v(5,Fe,4,3,"ng-container",6),s()()),t&2&&(r(3),a("ngIf",i.notResults),r(),a("dataObservable",i.onDataSubject.asObservable()),r(),a("ngForOf",i.overviews));},dependencies:[W,se,H,X,de,ae],styles:[".section-title[_ngcontent-%COMP%]{grid-column:1/-1}.margin-content[_ngcontent-%COMP%]{--gridVideosMiniatureMargins: var(--videosHorizontalMarginContent);margin-inline-start:var(--gridVideosMiniatureMargins)!important;margin-inline-end:var(--gridVideosMiniatureMargins)!important}@media screen and (max-width: 500px){.margin-content[_ngcontent-%COMP%]{--gridVideosMiniatureMargins: 0;width:auto}}@media screen and (min-width: 500px){.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]{--miniatureMinWidth: 255px;--miniatureMaxWidth: 280px;display:grid;column-gap:30px;grid-template-columns:repeat(auto-fill,minmax(var(--miniatureMinWidth),1fr))}.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]{margin:0 auto;width:100%}.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%]{display:block;min-width:var(--miniatureMinWidth);max-width:var(--miniatureMaxWidth)}}@media screen and (min-width: 500px) and (min-width: breakpoint(xm)){.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]{column-gap:15px}}@media screen and (min-width: 500px) and (min-width: breakpoint(fhd)){.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]{column-gap:2%}}.section[_ngcontent-%COMP%]:first-child{padding-top:15px}.section[_ngcontent-%COMP%]:first-child   .section-title[_ngcontent-%COMP%]{border-top:0!important}.section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:calc(1.275rem + .3vw);padding-top:1.25rem;margin-bottom:calc(1.325rem + .9vw)}@media (min-width: 1200px){.section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:1.5rem}}@media (min-width: 1200px){.section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin-bottom:2rem}}.section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]:not(h2){border-top:1px solid rgba(0,0,0,.1)}.section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{margin-bottom:0;display:inline-block;font-weight:700}.section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]   my-actor-avatar[_ngcontent-%COMP%]{display:inline-block;vertical-align:text-top;margin-inline-end:.5rem}@media screen and (max-width: 500px){.section[_ngcontent-%COMP%]{max-height:initial;overflow:initial}.section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin-inline-start:.625rem}}"]}));var me=f;var O=class O{constructor(e,t,i,l,m,g){this.server=e;this.route=t;this.videoService=i;this.hooks=l;this.meta=m;this.redirectService=g;n(this,"getVideosObservableFunction",this.getVideosObservable.bind(this));n(this,"getSyndicationItemsFunction",this.getSyndicationItems.bind(this));n(this,"baseRouteBuilderFunction",this.baseRouteBuilder.bind(this));n(this,"title");n(this,"titleTooltip");n(this,"groupByDate");n(this,"defaultSort");n(this,"defaultScope");n(this,"hookParams");n(this,"hookResult");n(this,"loadUserVideoPreferences",!0);n(this,"displayFilters",!0);n(this,"disabled",!1);n(this,"trendingDays");n(this,"routeSub");}ngOnInit(){this.trendingDays=this.server.getHTMLConfig().trending.videos.intervalDays,this.routeSub=this.route.params.subscribe(e=>{this.update(e.page);});}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe();}getVideosObservable(e,t){let i=k(E({},t.toVideosAPIObject()),{videoPagination:E({},e),skipCount:!0});return this.hooks.wrapObsFun(this.videoService.getVideos.bind(this.videoService),i,"common",this.hookParams,this.hookResult);}getSyndicationItems(e){let t=e.toVideosAPIObject();return this.videoService.getVideoFeedUrls(t.sort,t.isLocal);}onFiltersChanged(e){this.buildTitle(e.scope,e.sort),this.updateGroupByDate(e.sort);}baseRouteBuilder(e){let t=this.getSanitizedSort(e.sort),i;return e.scope==="local"?i="local":t==="publishedAt"?i="recently-added":i="trending",["/videos",i];}disableForReuse(){this.disabled=!0;}enabledForReuse(){this.disabled=!1;}update(e){let t=this.getData(e);this.hookParams=t.hookParams,this.hookResult=t.hookResult,this.defaultSort=t.sort,this.defaultScope=t.scope,this.buildTitle(),this.updateGroupByDate(this.defaultSort),this.meta.setTitle(this.title);}getData(e){return e==="trending"?this.generateTrendingData(this.route.snapshot):e==="local"?this.generateLocalData():this.generateRecentlyAddedData();}generateRecentlyAddedData(){return{sort:"-publishedAt",scope:"federated",hookParams:"filter:api.recently-added-videos.videos.list.params",hookResult:"filter:api.recently-added-videos.videos.list.result"};}generateLocalData(){return{sort:"-publishedAt",scope:"local",hookParams:"filter:api.local-videos.videos.list.params",hookResult:"filter:api.local-videos.videos.list.result"};}generateTrendingData(e){var i;return{sort:(i=e.queryParams.sort)!=null?i:this.parseTrendingAlgorithm(this.redirectService.getDefaultTrendingAlgorithm()),scope:"federated",hookParams:"filter:api.trending-videos.videos.list.params",hookResult:"filter:api.trending-videos.videos.list.result"};}parseTrendingAlgorithm(e){switch(e){case"most-viewed":return"-trending";case"most-liked":return"-likes";case"best":return"-hot";default:return"-"+e;}}updateGroupByDate(e){this.groupByDate=e==="-publishedAt"||e==="publishedAt";}buildTitle(e=this.defaultScope,t=this.defaultSort){let i=this.getSanitizedSort(t);if(e==="local"){this.title="M\xE1y ch\u1EE7",this.titleTooltip="Ch\u1EC9 hi\u1EC7n nh\u1EEFng video \u0111\u0103ng t\u1EEB m\xE1y ch\u1EE7 n\xE0y";return;}if(i==="publishedAt"){this.title="M\u1EDBi nh\u1EA5t",this.titleTooltip=void 0;return;}if(["hot","trending","likes","views"].includes(i)){if(this.title="Th\u1ECBnh h\xE0nh",i==="hot"){this.titleTooltip="Nh\u1EEFng video \u0111\u01B0\u1EE3c t\u01B0\u01A1ng t\xE1c g\u1EA7n \u0111\xE2y";return;}if(i==="likes"){this.titleTooltip="Nh\u1EEFng video \u0111\u01B0\u1EE3c y\xEAu th\xEDch nh\u1EA5t";return;}if(i==="views"){this.titleTooltip=void 0;return;}if(i==="trending"){if(this.trendingDays===1){this.titleTooltip="Nh\u1EEFng video \u0111\u01B0\u1EE3c xem nhi\u1EC1u nh\u1EA5t h\xF4m nay";return;}this.titleTooltip="Video \u0111\u01B0\u1EE3c xem nhi\u1EC1u nh\u1EA5t "+this.trendingDays+" ng\xE0y qua";}return;}}getSanitizedSort(e){return e.replace(/^-/,"");}};n(O,"\u0275fac",function(t){return new(t||O)(c(P),c(q),c(w),c(oe),c(te),c(Z));}),n(O,"\u0275cmp",y({type:O,selectors:[["ng-component"]],standalone:!0,features:[M],decls:1,vars:9,consts:[["displayFilters","true","displayModerationBlock","true","loadUserVideoPreferences","true","highlightLives","true",3,"filtersChanged","getVideosObservableFunction","getSyndicationItemsFunction","baseRouteBuilderFunction","title","titleTooltip","defaultSort","defaultScope","groupByDate","disabled"]],template:function(t,i){t&1&&(d(0,"my-videos-list",0),V("filtersChanged",function(m){return i.onFiltersChanged(m);}),s()),t&2&&a("getVideosObservableFunction",i.getVideosObservableFunction)("getSyndicationItemsFunction",i.getSyndicationItemsFunction)("baseRouteBuilderFunction",i.baseRouteBuilderFunction)("title",i.title)("titleTooltip",i.titleTooltip)("defaultSort",i.defaultSort)("defaultScope",i.defaultScope)("groupByDate",i.groupByDate)("disabled",i.disabled);},dependencies:[ce],encapsulation:2}));var ue=O;export{F as a,me as b,ue as c};/**i18n:2f710d33ac9c4f1483429afcadbb48fcf333aac524700807e70179670fe63b48*/